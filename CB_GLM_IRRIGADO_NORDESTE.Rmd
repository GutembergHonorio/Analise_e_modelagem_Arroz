---
title: "GLM IRRIGADO NORDESTE"
author: "Gutemberg Resende Honorio Filho"
date: "25/03/2021"
output: html_document
---



# Pacotes

```{r}
if(!require(tidyverse)) install.packages("tidyverse")

# Teste de normalidade 
if(!require(tseries)) install.packages("tseries")

# Teste de homocesdasticidade 
if(!require(olsrr)) install.packages("olsrr")



if(!require(scales)) install.packages("scales")

if(!require(reshape2)) install.packages("reshape2")

if(!require(egg)) install.packages("egg")



```


# DADOS
```{r Diretório} 

# DIRETÓRIO DOS DADOS 

Tabelabruta<- read.csv("d:/Users/Cristiane Resende/Desktop/Gutemberg Honorio/Mestrado/Repositorio_4/Analise_e_modelagem_Arroz/Merge_1980_2018.csv", header = TRUE, sep = ",", stringsAsFactors = FALSE) # tabela com os dados originais

# criando coluna com macrorregiões

Tabelabruta<- mutate(Tabelabruta,REGIAO = case_when(UF == 'GO'| UF == 'DF' |UF == 'MS' | UF == 'MT' ~ 'Centro_Oeste',
                              UF == 'AL'| UF == 'BA' |UF == 'CE' | UF == 'MA' | UF == 'PB' | UF == 'PE' | UF == 'PI' | UF == 'RN' | UF == 'SE' ~ 'Nordeste',
                              UF == 'AC' | UF == 'AM' | UF == 'AP' | UF == 'PA' | UF == 'RO' | UF == 'RR' | UF == 'TO' ~ 'Norte',
                              UF == 'ES' | UF == 'MG' | UF == 'SP' | UF == 'RJ' ~ 'Sudeste',
                              UF == 'RS' | UF == 'SC' | UF == 'PR' ~ 'Sul'))

# Tabelas acessório

TabelabrutaIRR = subset(Tabelabruta, SIST_CULT == "IRRIGATED") # Somente Irrigado
TabelabrutaTA = subset(Tabelabruta, SIST_CULT == "UPLAND") # Somente Terras altas

# Filtrando os dados


IRR<-TabelabrutaIRR %>% mutate(UR_Media=(umidade_Media),UR_V=	(umidade_V), UR_fld_m=	(umidade_fld_m),	UR_R=	(umidade_R), Graus_dia_ciclo=(graus_dia_ciclo), Graus_dia_FLO=(graus_dia_FLO+graus_dia_IP))

IRR <- select(IRR,latitude, longitude, GENOTIPO, ID_ENSAIO,ano, Altitude, REGIAO, UF, FLO_E, Tmax_Maxima ,Tmax_fld_m ,	Tmax_R,	Tmax_ACC_R, Tmax_Minima,	Tmax_Media,Tmax_V ,Tmax_ACC_V,	Tmin_Maxima,Tmin_Minima ,	Tmin_Media ,	Tmin_V ,	Tmin_ACC_V , Tmin_fld_m ,	Tmin_R,	Tmin_ACC_R , Chuva_ACC ,	Chuva_ACC_V, Chuva_ACC_R, Rad_ACC_R ,	Rad_ACC ,	Rad_ACC_V, UR_Media, UR_V, UR_fld_m,	UR_R, Graus_dia_ciclo, Graus_dia_FLO)


rm(TabelabrutaIRR,TabelabrutaTA,Tabelabruta)

# Removendo os genótipos que não serão estudados

IRR = IRR[IRR$GENOTIPO %in% c("ALIANCA",	"AVAXI CL",	"BR IRGA 409",	"BR IRGA 410",	"BR IRGA 412",	"BR IRGA 414",	"BRS 7 TAIM",	"BRS A701 CL",	"BRS A702 CL",	"BRS A704",	"BRS ALVORADA",	"BRS BIGUA",	"BRS CATIANA",	"BRS CIRAD 302",	"BRS FORMOSO",	"BRS FRONTEIRA",	"BRS GUARA",	"BRS JABURU",	"BRS JACANA",	"BRS PAMPA",	"BRS PAMPEIRA",	"BRS PELOTA",	"BRS QUERENCIA",	"BRS SINUELO CL",	"BRS TROPICAL",	"BRSMG RUBELITA",	"CICA 8",	"CT8452",	"DIAMANTE",	"EEA34",	"EMPASC 101",	"EMPASC 102",	"EPAGRI 108",	"EPAGRI 109",	"EPAGRI97-01",	"EPAGRI97-05",	"EPAGRI97-06",	"H6",	"H7 CL",	"IAC1289",	"IAC1298",	"IAC1299",	"IAC1307",	"IAC1311",	"IAPAR 58",	"IRGA 417",	"IRGA 422 CL",	"IRGA 424",	"IRGA 424 RI",	"IRGA 425",	"IRGA 426",	"IRGA 427",	"IRGA 428",	"IRGA 429",	"IRGA 430",	"IRGA97-05",	"IRGA97-10",	"IRGA97-11",	"IRGA97-28",	"JAVAE",	"JEQUITIBA",	"MARAJO",	"METICA 1",	"MOXOTO",	"OUROMINAS",	"PR267",	"PR268",	"PR306",	"PR331",	"PR349",	"PR380",	"PR498",	"PR631",	"PR67",	"PUITA INTA CL",	"RORAIMA",	"SAO FRANCISCO",	"SC138",	"SC173",	"SC237",	"SC240",	"SC250",	"SCS 112",	"SCS 114 ANDOSAN",	"SCS 116 SATORU",	"SCS 121 CL",	"SCSBRS 111",	"SCSBRS 113 TIO TAKA",	"SCSBRS PIRACEMA",	"SG11551",	"URUCUI"),]
IRR = IRR[IRR$UF!="MT",]

# Filtrando e gerando médias

IRR_Medio<- IRR %>% group_by(ID_ENSAIO, GENOTIPO, REGIAO) %>% summarise(  FLO_M= mean(FLO_E),  latitude= mean(latitude), longitude = mean(longitude), Altitude = mean(Altitude), Tmax_Maxima = mean(Tmax_Maxima) ,Tmax_fld_m = mean(Tmax_fld_m ),	Tmax_R= mean( Tmax_R),	Tmax_ACC_R= mean(Tmax_ACC_R ), Tmax_Minima= mean(Tmax_Minima ),	Tmax_Media= mean( Tmax_Media),Tmax_V = mean(Tmax_V ),Tmax_ACC_V= mean(Tmax_ACC_V ),	Tmin_Maxima= mean(Tmin_Maxima ),Tmin_Minima = mean(Tmin_Minima ),	Tmin_Media = mean(Tmin_Media ),	Tmin_V = mean(Tmin_V ),	Tmin_ACC_V = mean(Tmin_ACC_V ), Tmin_fld_m = mean( Tmin_fld_m),	Tmin_R= mean(Tmin_R ),	Tmin_ACC_R = mean(Tmin_ACC_R ), Chuva_ACC = mean(Chuva_ACC ),	Chuva_ACC_V= mean(Chuva_ACC_V ), Chuva_ACC_R= mean(Chuva_ACC_R ), Rad_ACC_R = mean(Rad_ACC_R ),	Rad_ACC = mean(Rad_ACC ),	Rad_ACC_V= mean(Rad_ACC_V ), UR_Media= mean( UR_Media), UR_V= mean( UR_V), UR_fld_m= mean(UR_fld_m ),	UR_R= mean(UR_R ), Graus_dia_ciclo= mean(Graus_dia_ciclo ), Graus_dia_FLO= mean(Graus_dia_FLO ))

# separando por macrorregião

Nordeste<- subset(IRR_Medio, (REGIAO == "Nordeste")) # filtrando por região
```
#1) LINK log
```{r}
Temporario <- Nordeste[,c(-1,-3)] # retirando as vaiáveis REGIAO e ID_ENSAIO
modelo_glm_NE_<- glm(FLO_M~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_NE_)
```
 
```{r}
# Testes de hip?teses de interesse

source("teste-CB.txt")

# Comparacoes multiplas

# fit.model: sa?da do modelo ajustado
# m.C: matriz de interesse

testeF.CB <- function(fit.model,m.C)

{

v.beta <-  cbind(fit.model$coef)

n <- nrow(model.matrix(fit.model))

e.p <- nrow(v.beta)

e.q <- nrow(m.C)

m.cov.beta <- (vcov(fit.model))

e.F <- t(m.C%*%v.beta)%*%solve(m.C%*%m.cov.beta%*%t(m.C))%*%(m.C%*%v.beta)/e.q

e.pvalor <- 1-pf(e.F,e.q,n-e.p)

cat("Estatistica F = ",round(e.F,2),"\n")

cat("pvalor = ",round(e.pvalor,4),"\n")

cat("Matriz C :","\n")

print(m.C)

}

testeF.CB.poder <- function(fit.model,m.C,alpha)

{

v.beta <-  cbind(fit.model$coef)

n <- nrow(model.matrix(fit.model))

e.p <- nrow(v.beta)

e.q <- nrow(m.C)

m.cov.beta <- (vcov(fit.model))

m.X <- model.matrix(fit.model)

e.F <- t(m.C%*%v.beta)%*%solve(m.C%*%m.cov.beta%*%t(m.C))%*%(m.C%*%v.beta)/e.q   ##  m.cov.beta=sigma2(x?x)^-1 que tem dist.?qui-quadrado

e.pvalor <- 1-pf(e.F,e.q,n-e.p)                                                  ##

e.sigma2 <- deviance(fit.model)/df.residual(fit.model)                           ## sigma2 estimado

e.delta <- (t(m.C%*%v.beta)%*%solve(m.C%*%solve(t(m.X)%*%m.X)%*%t(m.C))%*%(m.C%*%v.beta))/e.sigma2

F.critico <- qf(1-alpha,e.q,n-e.p)       ## f cr?tico sob h0

e.poder <- 1-pf(F.critico,e.q,n-e.p,ncp=e.delta)

cat("Estatistica F = ",round(e.F,2),"\n")

cat("pvalor = ",round(e.pvalor,4),"\n")

cat("poder observado = ",round(e.poder,4),"\n")

cat("Matriz C :","\n")

print(m.C)

}



testeF.CBM <- function(fit.model,m.C,m.M)

{

v.beta <-  cbind(fit.model$coef)

n <- nrow(model.matrix(fit.model))

e.p <- nrow(v.beta)

e.q <- nrow(m.C)

m.cov.beta <- (vcov(fit.model))

e.F <- t(m.C%*%v.beta-m.M)%*%solve(m.C%*%m.cov.beta%*%t(m.C))%*%(m.C%*%v.beta-m.M)/e.q

e.pvalor <- 1-pf(e.F,e.q,n-e.p)

cat("Estatistica F = ",round(e.F,2),"\n")

cat("pvalor = ",round(e.pvalor,4),"\n")

cat("Matriz C :","\n")

print(m.C)

cat("Matriz M :","\n")

print(m.M)

}
```



Ordem da remoção das variáveis numéricas

Tmax_ACC_R (p = 0.970645)

```{r}
fit.model<-modelo_glm_NE_
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmax_ACC_R)
modelo_glm_NE_1<- glm(FLO_M~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_NE_1)
```

UR_fld_m (p = 0.960489)

```{r}
fit.model<-modelo_glm_NE_1
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-UR_fld_m)
modelo_glm_NE_2<- glm(FLO_M~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_NE_2)
```

Tmin_Media (p = 0.526558)

```{r}
fit.model<-modelo_glm_NE_2
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,	0)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmin_Media)
modelo_glm_NE_3<- glm(FLO_M~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_NE_3)
```

longitude (p = 0.416927)

```{r}
fit.model<-modelo_glm_NE_3
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,		0,	0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,	0)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-longitude)
modelo_glm_NE_4<- glm(FLO_M~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_NE_4)
```

Tmin_fld_m (p = 0.381665)

```{r}
fit.model<-modelo_glm_NE_4
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,	0,	0,		0,	0,	0,	0,	0,	0,		0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,	0)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmin_fld_m)
modelo_glm_NE_5<- glm(FLO_M~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_NE_5)
```

Tmax_fld_m  (p = 0.594186)

```{r}
fit.model<-modelo_glm_NE_5
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,	1,	0,		0,	0,	0,	0,	0,	0,		0,	0,		0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,	0)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmax_fld_m)
modelo_glm_NE_6<- glm(FLO_M~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_NE_6)
```

Tmax_Maxima  (p = 0.393161)

```{r}
fit.model<-modelo_glm_NE_6
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	1,		0,		0,	0,	0,	0,	0,	0,		0,	0,		0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,	0)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmax_Maxima)
modelo_glm_NE_7<- glm(FLO_M~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_NE_7)
```

Rad_ACC_R (p = 0.389531)

```{r}
fit.model<-modelo_glm_NE_7
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,			0,		0,	0,	0,	0,	0,	0,		0,	0,		0,	0,	0,	0,	0,	1,	0,	0,	0,	0,		0,	0,	0)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Rad_ACC_R)
modelo_glm_NE_8<- glm(FLO_M~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_NE_8)
```

Tmax_Minima  (p = 0.496966)

```{r}
fit.model<-modelo_glm_NE_8
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,			0,		1,	0,	0,	0,	0,	0,		0,	0,		0,	0,	0,	0,	0,		0,	0,	0,	0,		0,	0,	0)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmax_Minima)
modelo_glm_NE_9<- glm(FLO_M~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_NE_9)
```

UR_V  (p = 0.369496)

```{r}
fit.model<-modelo_glm_NE_9
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,			0,			0,	0,	0,	0,	0,		0,	0,		0,	0,	0,	0,	0,		0,	0,	0,	1,		0,	0,	0)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-UR_V)
modelo_glm_NE_10<- glm(FLO_M~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_NE_10)
```

Chuva_ACC_R (p = 0.347308)

```{r}
fit.model<-modelo_glm_NE_10
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,			0,			0,	0,	0,	0,	0,		0,	0,		0,	0,	0,	0,	1,		0,	0,	0,			0,	0,	0)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Chuva_ACC_R)
modelo_glm_NE_11<- glm(FLO_M~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_NE_11)
```

UR_Media  (p = 0.409131)

```{r}
fit.model<-modelo_glm_NE_11
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,			0,			0,	0,	0,	0,	0,		0,	0,		0,	0,	0,	0,			0,	0,	1,			0,	0,	0)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-UR_Media)
modelo_glm_NE_12<- glm(FLO_M~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_NE_12)
```

latitude  (p = 0.203604)

```{r}
fit.model<-modelo_glm_NE_12
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,		0,			0,			0,	0,	0,	0,	0,		0,	0,		0,	0,	0,	0,			0,	0,				0,	0,	0)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-latitude)
modelo_glm_NE_13<- glm(FLO_M~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_NE_13)
```

Graus_dia_ciclo (p = 0.381067)

```{r}
fit.model<-modelo_glm_NE_13
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,			0,			0,			0,	0,	0,	0,	0,		0,	0,		0,	0,	0,	0,			0,	0,				0,	1,	0)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Graus_dia_ciclo)
modelo_glm_NE_14<- glm(FLO_M~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_NE_14)
```

Rad_ACC_V (p = 0.326418)

```{r}
fit.model<-modelo_glm_NE_14
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,			0,			0,			0,	0,	0,	0,	0,		0,	0,		0,	0,	0,	0,			0,	1,				0,		0)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Rad_ACC_V)
modelo_glm_NE_15<- glm(FLO_M~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_NE_15)
```

Tmin_ACC_V (p = 0.063679)

```{r}
fit.model<-modelo_glm_NE_15
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,			0,			0,			0,	0,	0,	0,	0,		0,	1,		0,	0,	0,	0,			0,					0,		0)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmin_ACC_V)
modelo_glm_NE_16<- glm(FLO_M~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_NE_16)
```
```{r}
fit.model<-modelo_glm_NE_16
m.C <- rbind(cbind(	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	)
)
testeF.CB(fit.model,m.C)
```
O genotipo que está no intecept é o ALIANCA

```{r}

Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("ALIANCA", "BRS A704",	"CICA 8",	"EMPASC 101",	"EPAGRI 108",	"EPAGRI 109",	"MOXOTO",	"PR268")

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_NE_17<- glm(FLO_M~.,Temporario, family = Gamma(link = "log" )) 
summary(modelo_glm_NE_17)

```

```{r}
fit.model<-modelo_glm_NE_17
m.C <- rbind(cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	))
testeF.CB(fit.model,m.C)
```


```{r}

Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("BRS JABURU","SCS 114 ANDOSAN")

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_NE_18<-glm(FLO_M~.,Temporario, family = Gamma(link = "log" )) 
summary(modelo_glm_NE_18)

```

```{r}
fit.model<-modelo_glm_NE_18
m.C <- rbind(cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	))
testeF.CB(fit.model,m.C)
```


```{r}

Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("BRS FORMOSO","IAC1298", "SCS 116 SATORU", "SCS 121 CL")

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_NE_19<-glm(FLO_M~.,Temporario, family = Gamma(link = "log" )) 
summary(modelo_glm_NE_19)

```

```{r}
fit.model<-modelo_glm_NE_19
m.C <- rbind(cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	))
testeF.CB(fit.model,m.C)
```


```{r}

Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("BRS GUARA","IAC1299","PR267","SCSBRS 113 TIO TAKA")

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_NE_20<-glm(FLO_M~.,Temporario, family = Gamma(link = "log" )) 
summary(modelo_glm_NE_20)

```
```{r}
fit.model<-modelo_glm_NE_20
m.C <- rbind(cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	))
testeF.CB(fit.model,m.C)
```


```{r}

Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("BRS CATIANA","BRSMG RUBELITA" )

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_NE_21<-glm(FLO_M~.,Temporario, family = Gamma(link = "log" )) 
summary(modelo_glm_NE_21)

```


```{r}
fit.model<-modelo_glm_NE_21
m.C <- cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	)
testeF.CB(fit.model,m.C)
```


```{r}

Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("IAC1307")

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_NE_22<-glm(FLO_M~.,Temporario, family = Gamma(link = "log" )) 
summary(modelo_glm_NE_22)

```

```{r}
fit.model<-modelo_glm_NE_22
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0)
testeF.CB(fit.model,m.C)
```


```{r}

Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("BRS ALVORADA")

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_NE_23<-glm(FLO_M~.,Temporario, family = Gamma(link = "log" )) 
summary(modelo_glm_NE_23)

```

```{r}
fit.model<-modelo_glm_NE_23
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0)
testeF.CB(fit.model,m.C)
```


```{r}

Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("OUROMINAS")

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_NE_24<-glm(FLO_M~.,Temporario, family = Gamma(link = "log" )) 
summary(modelo_glm_NE_24)

```


```{r}
fit.model<-modelo_glm_NE_24
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0)
testeF.CB(fit.model,m.C)
```


```{r}

Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("BRS PAMPEIRA")

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_NE_25<-glm(FLO_M~.,Temporario, family = Gamma(link = "log" )) 
summary(modelo_glm_NE_25)

```

Tmin_Maxima (p = 0.062980)

```{r}
fit.model<-modelo_glm_NE_25
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmin_Maxima)
modelo_glm_NE_26<- glm(FLO_M~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_NE_26)
```

```{r}
Temporario_glm_NE_26 <- Temporario
```


## Analise de residos.

```{r}
#------------------------------------------------------------#
# Para rodar este programa deixe no objeto fit.model a saída      
# do ajuste da regressão com erros gama e ligação log.  Deixe     
# também os dados disponíveis através do comando attach(...).    
# Depois use o comando source(...) no R ou S-Plus para        
# executar o programa. A sequência de comandos é a seguinte:               
#
       fit.model <- modelo_glm_NE_26
       attach(Temporario_glm_NE_26)
       source("envel_gama.txt")                                      
#
# A saída será o gráfico de envelope para o resíduo componente 
# do desvio padronizado. Para colocar um título no gráfico use
# o comando title("..."). Para  usar  outras  ligações mudar 
# no programa abaixo o termo family=Gamma(link=log) para 
# family=Gamma no caso de ligação  recíproca ou por 
# family= Gamma(link=identity) no caso de ligação identidade.
#------------------------------------------------------------#
par(mfrow=c(1,1))
X <- model.matrix(fit.model)
n <- nrow(X)
p <- ncol(X)
w <- fit.model$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit.model,type="response")
fi <- (n-p)/sum((ro/(fitted(fit.model)))^ 2)
td <- resid(fit.model,type="deviance")*sqrt(fi/(1-h))
#
e <- matrix(0,n,100)
#
for(i in 1:100){
resp <- rgamma(n,fi)
resp <- (fitted(fit.model)/fi)*resp
fit <- glm(resp ~ X, family=Gamma(link=log))
w <- fit$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit,type="response")
phi <- (n-p)/sum((ro/(fitted(fit)))^ 2)
e[,i] <- sort(resid(fit,type="deviance")*sqrt(phi/(1-h)))}
#
e1 <- numeric(n)
e2 <- numeric(n)
#
for(i in 1:n){
  eo <- sort(e[i,])
e1[i] <- (eo[2]+eo[3])/2
e2[i] <- (eo[97]+eo[98])/2}
#
med <- apply(e,1,mean)
faixa <- range(td,e1,e2)
par(pty="s")
qqnorm(td, xlab="Percentil da N(0,1)",
ylab="Componente do Desvio", ylim=faixa, pch=16, main="")
par(new=TRUE)
#
qqnorm(e1,axes=F,xlab="",ylab="",type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(e2,axes=F,xlab="",ylab="", type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(med,axes=F,xlab="", ylab="", type="l",ylim=faixa,lty=2, main="")
#------------------------------------------------------------#          
```

```{r}
#------------------------------------------------------------#
# Para rodar este programa  deixe no objeto fit.model a saída 
# do  ajuste  da  regressão com  erros gama.   Deixe  os dados 
# disponíveis  através do comando attach(...). Depois  use  o 
# comando source(...) no S-Plus ou R para executar o programa. 
# A sequência de comandos é a seguinte:
#
         fit.model <- modelo_glm_NE_26
         attach(Temporario_glm_NE_26)
         source("diag_gama.txt")
#
# A saída terá quatro gráficos: de pontos de alacanca, 
# de pontos influentes  e  dois de resíduos. Para 
# identificar os pontos que  mais  se destacam usar o 
# comando identify(...). Se por exemplo se destacam
# três pontos no plot(fitted(fit.model),h,...), 
# após esse comando coloque
#     
#        > identify(fitted(fit.model),h,n=3)
#
# O mesmo pode ser feito nos demais gráficos. Nos gráficos de 
# resíduos foram colocados os limites ylim=c(a-1,b+1), 
# em que a é o menor valor e b o maior valor para o resíduo. 
# Este programa usa a library MASS para estimar o parâmetro
# fi da gama que  estará guardado no objeto fi.
#------------------------------------------------------------#
X <- model.matrix(fit.model)
n <- nrow(X)
p <- ncol(X)
w <- fit.model$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
library(MASS)
fi <- gamma.shape(fit.model)$alpha
ts <- resid(fit.model,type="pearson")*sqrt(fi/(1-h))
td <- resid(fit.model,type="deviance")*sqrt(fi/(1-h))
di <- (h/(1-h))*(ts^2)
par(mfrow=c(2,2))
a <- max(td)
b <- min(td)
plot(fitted(fit.model),h,xlab="Valor Ajustado", ylab="Medida h", pch=16)
#identify(fitted(fit.model), h, n=1)
#
plot(di,xlab="Índice", ylab="Distância de Cook", pch=16)
#identify(di, n=2)
#
plot(fitted(fit.model),td,xlab="Valor Ajustado", ylab="Resíduo Componente do Desvio",
ylim=c(b-1,a+1),pch=16)
abline(2,0,lty=2)
abline(-2,0,lty=2)
#identify(fitted(fit.model),td, n=1)
#
w <- fit.model$weights
eta <- predict(fit.model)
z <- eta + resid(fit.model, type="pearson")/sqrt(w)
plot(predict(fit.model),z,xlab="Preditor Linear", 
ylab="Variável z", pch=16)
par(mfrow=c(1,1))
#------------------------------------------------------------#

```

## Retirando linhas

```{r}
teste<-td
teste1 <- sort(teste)
match(teste1[1:3], teste)
```

```{r}
Temporario<-Temporario_glm_NE_26[c(-392, -177, -175),]
modelo_glm_NE_27<-glm(FLO_M~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_NE_27)
```
```{r}
 detach("package:MASS", unload = TRUE)
```
Chuva_ACC_V           -7.717e-07  4.231e-07  -1.824 0.068911

```{r}
Temporario<-Temporario %>% select(-Chuva_ACC_V)
modelo_glm_NE_27<-glm(FLO_M~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_NE_27)
```

```{r}
#------------------------------------------------------------#
# Para rodar este programa deixe no objeto fit.model a saída      
# do ajuste da regressão com erros gama e ligação log.  Deixe     
# também os dados disponíveis através do comando attach(...).    
# Depois use o comando source(...) no R ou S-Plus para        
# executar o programa. A sequência de comandos é a seguinte:               
#
       fit.model <- modelo_glm_NE_27
       attach(Temporario)
       source("envel_gama.txt")                                      
#
# A saída será o gráfico de envelope para o resíduo componente 
# do desvio padronizado. Para colocar um título no gráfico use
# o comando title("..."). Para  usar  outras  ligações mudar 
# no programa abaixo o termo family=Gamma(link=log) para 
# family=Gamma no caso de ligação  recíproca ou por 
# family= Gamma(link=identity) no caso de ligação identidade.
#------------------------------------------------------------#
par(mfrow=c(1,1))
X <- model.matrix(fit.model)
n <- nrow(X)
p <- ncol(X)
w <- fit.model$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit.model,type="response")
fi <- (n-p)/sum((ro/(fitted(fit.model)))^ 2)
td <- resid(fit.model,type="deviance")*sqrt(fi/(1-h))
#
e <- matrix(0,n,100)
#
for(i in 1:100){
resp <- rgamma(n,fi)
resp <- (fitted(fit.model)/fi)*resp
fit <- glm(resp ~ X, family=Gamma(link=log))
w <- fit$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit,type="response")
phi <- (n-p)/sum((ro/(fitted(fit)))^ 2)
e[,i] <- sort(resid(fit,type="deviance")*sqrt(phi/(1-h)))}
#
e1 <- numeric(n)
e2 <- numeric(n)
#
for(i in 1:n){
  eo <- sort(e[i,])
e1[i] <- (eo[2]+eo[3])/2
e2[i] <- (eo[97]+eo[98])/2}
#
med <- apply(e,1,mean)
faixa <- range(td,e1,e2)
par(pty="s")
qqnorm(td, xlab="Percentil da N(0,1)",
ylab="Componente do Desvio", ylim=faixa, pch=16, main="")
par(new=TRUE)
#
qqnorm(e1,axes=F,xlab="",ylab="",type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(e2,axes=F,xlab="",ylab="", type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(med,axes=F,xlab="", ylab="", type="l",ylim=faixa,lty=2, main="")

#------------------------------------------------------------#          
```




## Transf. log


```{r}
Temporario <- Nordeste[,c(-1,-3)] # retirando as vaiáveis REGIAO e ID_ENSAIO
modelo_glm_Log_Log_NE_<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_Log_NE_)
```
```{r}
fit.model<-modelo_glm_Log_Log_NE_
m.C <- rbind(cbind(	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0
)
)
testeF.CB(fit.model,m.C)
```
```{r}
Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("ALIANCA","BRS A704", "BRS JABURU","CICA 8","EMPASC 101", "EPAGRI 108" ,   "EPAGRI 109",  "MOXOTO",   "PR268",   "SCS 114 ANDOSAN")

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_Log_Log_NE_1<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_Log_NE_1)
```
```{r}
fit.model<-modelo_glm_Log_Log_NE_1
m.C <- rbind(cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	))
testeF.CB(fit.model,m.C)
```

```{r}
Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("BRS FORMOSO",    "BRS GUARA",    "IAC1298",   "IAC1299",  "PR267",    "SCS 116 SATORU",     "SCS 121 CL",    "SCSBRS 113 TIO TAKA")

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_Log_Log_NE_2<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_Log_NE_2)
```
```{r}
fit.model<-modelo_glm_Log_Log_NE_2
m.C <- rbind(cbind(	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,		0,		0,	0,	0,	0,	0,	0,	0,	0,	0,			0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,	0,	0,	0,			0,		0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,		0,		0,	0,	0,	0,	0,	0,	0,	0,	0,			0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,	0,	0,	0,			0,		0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,		0,	0,	0,	0,	0,	0,	0,	0,	0,			1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,	0,	0,	0,			0,		0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,		0,	0,	0,	0,	0,	0,	0,	0,	0,			0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,		0,	0,	0,	0,	0,			0,		0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	))
testeF.CB(fit.model,m.C)
```


```{r}
Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("BRS ALVORADA",  "BRS CATIANA",    "IAC1307",     "OUROMINAS")

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_Log_Log_NE_3<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_Log_NE_3)
```


```{r}
fit.model<-modelo_glm_Log_Log_NE_3
m.C <- rbind(cbind(	0,	0,	0,	0,	0,	0,	0,		0,			0,		0,	0,	1,	0,	0,	0,	0,	0,	0,				0,	0,	0,	0,	0,	0,	0,	0,	0,			0,	0,	0,	0,	0,			0,		0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0),
cbind(	0,	0,	0,	0,	0,	0,	0,		0,			0,		0,	0,	0,	0,	1,	0,	0,	0,	0,				0,	0,	0,	0,	0,	0,	0,	0,	0,			0,	0,	0,	0,	0,			0,		0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0))
testeF.CB(fit.model,m.C)
```


```{r}
Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("BRS PAMPEIRA",      "BRSMG RUBELITA")

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_Log_Log_NE_4<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_Log_NE_4)
```
Tmin_Media (p = 0.763180)

```{r}
fit.model<-modelo_glm_Log_Log_NE_4
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0
)
testeF.CB(fit.model,m.C)
```

```{r}
Temporario<- Temporario %>% select(-Tmin_Media)

modelo_glm_Log_Log_NE_5<-glm(log(FLO_M)~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_Log_NE_5)
```

UR_fld_m (p = 0.627459)

```{r}
fit.model<-modelo_glm_Log_Log_NE_5
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0
)
testeF.CB(fit.model,m.C)
```

```{r}
Temporario<- Temporario %>% select(- UR_fld_m)

modelo_glm_Log_Log_NE_6<-glm(log(FLO_M)~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_Log_NE_6)
```

Tmax_fld_m (p = 0.519578)

```{r}
fit.model<-modelo_glm_Log_Log_NE_6
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,	0
)
testeF.CB(fit.model,m.C)
```

```{r}
Temporario<- Temporario %>% select(- Tmax_fld_m)

modelo_glm_Log_Log_NE_7<-glm(log(FLO_M)~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_Log_NE_7)
```

Tmax_ACC_R  (p = 0.461984)

```{r}
fit.model<-modelo_glm_Log_Log_NE_7
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	1,	0,	0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,	0
)
testeF.CB(fit.model,m.C)
```

```{r}
Temporario<- Temporario %>% select(- Tmax_ACC_R)

modelo_glm_Log_Log_NE_8<-glm(log(FLO_M)~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_Log_NE_8)
```

Chuva_ACC  (p = 0.473014)

```{r}
fit.model<-modelo_glm_Log_Log_NE_8
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,		0,	0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,		0,	0,	0
)
testeF.CB(fit.model,m.C)
```

```{r}
Temporario<- Temporario %>% select(- Chuva_ACC)

modelo_glm_Log_Log_NE_9<-glm(log(FLO_M)~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_Log_NE_9)
```

Tmax_Minima (p = 0.482680)

```{r}
fit.model<-modelo_glm_Log_Log_NE_9
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,		1,	0,	0,	0,	0,	0,		0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	0,	0,		0,	0,	0
)
testeF.CB(fit.model,m.C)
```

```{r}
Temporario<- Temporario %>% select(- Tmax_Minima)

modelo_glm_Log_Log_NE_10<-glm(log(FLO_M)~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_Log_NE_10)
```

Rad_ACC_R (p = 0.211125)

```{r}
fit.model<-modelo_glm_Log_Log_NE_10
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,			0,	0,	0,	0,	0,		0,	0,	0,	0,	0,		0,	0,	1,	0,	0,	0,	0,		0,	0,	0
)
testeF.CB(fit.model,m.C)
```

```{r}
Temporario<- Temporario %>% select(- Rad_ACC_R)

modelo_glm_Log_Log_NE_11<-glm(log(FLO_M)~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_Log_NE_11)
```

longitude  (p = 0.247176)

```{r}
fit.model<-modelo_glm_Log_Log_NE_11
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,		0,			0,	0,	0,	0,	0,		0,	0,	0,	0,	0,		0,	0,		0,	0,	0,	0,		0,	0,	0
)
testeF.CB(fit.model,m.C)
```

```{r}
Temporario<- Temporario %>% select(- longitude)

modelo_glm_Log_Log_NE_12<-glm(log(FLO_M)~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_Log_NE_12)
```

Rad_ACC (p = 0.254549)

```{r}
fit.model<-modelo_glm_Log_Log_NE_12
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,		0,			0,	0,	0,	0,	0,		0,	0,	0,	0,	0,		0,	0,		1,	0,	0,	0,		0,	0,	0
)
testeF.CB(fit.model,m.C)
```

```{r}
Temporario<- Temporario %>% select(- Rad_ACC)

modelo_glm_Log_Log_NE_13<-glm(log(FLO_M)~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_Log_NE_13)
```

Tmax_Maxima (p = 0.260389)

```{r}
fit.model<-modelo_glm_Log_Log_NE_13
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	1,		0,			0,	0,	0,	0,	0,		0,	0,	0,	0,	0,		0,	0,			0,	0,	0,		0,	0,	0
)
testeF.CB(fit.model,m.C)
```

```{r}
Temporario<- Temporario %>% select(- Tmax_Maxima)

modelo_glm_Log_Log_NE_14<-glm(log(FLO_M)~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_Log_NE_14)
```

Tmin_fld_m  (p = 0.138394)

```{r}
fit.model<-modelo_glm_Log_Log_NE_14
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,			0,			0,	0,	0,	0,	0,		0,	0,	1,	0,	0,		0,	0,			0,	0,	0,		0,	0,	0
)
testeF.CB(fit.model,m.C)
```

```{r}
Temporario<- Temporario %>% select(- Tmin_fld_m)

modelo_glm_Log_Log_NE_15<-glm(log(FLO_M)~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_Log_NE_15)
```

latitude (p = 0.095739)

```{r}
fit.model<-modelo_glm_Log_Log_NE_15
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,		0,			0,			0,	0,	0,	0,	0,		0,	0,		0,	0,		0,	0,			0,	0,	0,		0,	0,	0
)
testeF.CB(fit.model,m.C)
```

```{r}
Temporario<- Temporario %>% select(- latitude)

modelo_glm_Log_Log_NE_16<-glm(log(FLO_M)~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_Log_NE_16)
```
Graus_dia_ciclo (p = 0.131688)

```{r}
fit.model<-modelo_glm_Log_Log_NE_16
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,			0,			0,	0,	0,	0,	0,		0,	0,		0,	0,		0,	0,			0,	0,	0,		0,	1,	0
)
testeF.CB(fit.model,m.C)
```

```{r}
Temporario<- Temporario %>% select(- Graus_dia_ciclo)

modelo_glm_Log_Log_NE_17<-glm(log(FLO_M)~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_Log_NE_17)
```
```{r}
Temporario_glm_Log_Log_NE_18 <- Temporario

```

### Analise de residos.

```{r}
#------------------------------------------------------------#
# Para rodar este programa deixe no objeto fit.model a saída      
# do ajuste da regressão com erros gama e ligação log.  Deixe     
# também os dados disponíveis através do comando attach(...).    
# Depois use o comando source(...) no R ou S-Plus para        
# executar o programa. A sequência de comandos é a seguinte:               
#
       fit.model <- modelo_glm_Log_Log_NE_17
       attach(Temporario_glm_Log_Log_NE_18)
       source("envel_gama.txt")                                      
#
# A saída será o gráfico de envelope para o resíduo componente 
# do desvio padronizado. Para colocar um título no gráfico use
# o comando title("..."). Para  usar  outras  ligações mudar 
# no programa abaixo o termo family=Gamma(link=log) para 
# family=Gamma no caso de ligação  recíproca ou por 
# family= Gamma(link=identity) no caso de ligação identidade.
#------------------------------------------------------------#
par(mfrow=c(1,1))
X <- model.matrix(fit.model)
n <- nrow(X)
p <- ncol(X)
w <- fit.model$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit.model,type="response")
fi <- (n-p)/sum((ro/(fitted(fit.model)))^ 2)
td <- resid(fit.model,type="deviance")*sqrt(fi/(1-h))
#
e <- matrix(0,n,100)
#
for(i in 1:100){
resp <- rgamma(n,fi)
resp <- (fitted(fit.model)/fi)*resp
fit <- glm(resp ~ X, family=Gamma(link=log))
w <- fit$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit,type="response")
phi <- (n-p)/sum((ro/(fitted(fit)))^ 2)
e[,i] <- sort(resid(fit,type="deviance")*sqrt(phi/(1-h)))}
#
e1 <- numeric(n)
e2 <- numeric(n)
#
for(i in 1:n){
  eo <- sort(e[i,])
e1[i] <- (eo[2]+eo[3])/2
e2[i] <- (eo[97]+eo[98])/2}
#
med <- apply(e,1,mean)
faixa <- range(td,e1,e2)
par(pty="s")
qqnorm(td, xlab="Percentil da N(0,1)",
ylab="Componente do Desvio", ylim=faixa, pch=16, main="")
par(new=TRUE)
#
qqnorm(e1,axes=F,xlab="",ylab="",type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(e2,axes=F,xlab="",ylab="", type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(med,axes=F,xlab="", ylab="", type="l",ylim=faixa,lty=2, main="")

#------------------------------------------------------------#          
```

```{r}
#------------------------------------------------------------#
# Para rodar este programa  deixe no objeto fit.model a saída 
# do  ajuste  da  regressão com  erros gama.   Deixe  os dados 
# disponíveis  através do comando attach(...). Depois  use  o 
# comando source(...) no S-Plus ou R para executar o programa. 
# A sequência de comandos é a seguinte:
#
         fit.model <- modelo_glm_Log_Log_NE_17
         attach(Temporario_glm_Log_Log_NE_18)
         source("diag_gama.txt")
#
# A saída terá quatro gráficos: de pontos de alacanca, 
# de pontos influentes  e  dois de resíduos. Para 
# identificar os pontos que  mais  se destacam usar o 
# comando identify(...). Se por exemplo se destacam
# três pontos no plot(fitted(fit.model),h,...), 
# após esse comando coloque
#     
#        > identify(fitted(fit.model),h,n=3)
#
# O mesmo pode ser feito nos demais gráficos. Nos gráficos de 
# resíduos foram colocados os limites ylim=c(a-1,b+1), 
# em que a é o menor valor e b o maior valor para o resíduo. 
# Este programa usa a library MASS para estimar o parâmetro
# fi da gama que  estará guardado no objeto fi.
#------------------------------------------------------------#
X <- model.matrix(fit.model)
n <- nrow(X)
p <- ncol(X)
w <- fit.model$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
library(MASS)
fi <- gamma.shape(fit.model)$alpha
ts <- resid(fit.model,type="pearson")*sqrt(fi/(1-h))
td <- resid(fit.model,type="deviance")*sqrt(fi/(1-h))
di <- (h/(1-h))*(ts^2)
par(mfrow=c(2,2))
a <- max(td)
b <- min(td)
plot(fitted(fit.model),h,xlab="Valor Ajustado", ylab="Medida h", pch=16)
#identify(fitted(fit.model), h, n=1)
#
plot(di,xlab="Índice", ylab="Distância de Cook", pch=16)
#identify(di, n=2)
#
plot(fitted(fit.model),td,xlab="Valor Ajustado", ylab="Resíduo Componente do Desvio",
ylim=c(b-1,a+1),pch=16)
abline(2,0,lty=2)
abline(-2,0,lty=2)
#identify(fitted(fit.model),td, n=1)
#
w <- fit.model$weights
eta <- predict(fit.model)
z <- eta + resid(fit.model, type="pearson")/sqrt(w)
plot(predict(fit.model),z,xlab="Preditor Linear", 
ylab="Variável z", pch=16)
par(mfrow=c(1,1))
#------------------------------------------------------------#

```

```{r}
 detach("package:MASS", unload = TRUE)
```

### Retirando linhas

```{r}
teste<-td
teste1 <- sort(teste)
match(teste1[1:3], teste)
```

```{r}
Temporario<-Temporario_glm_Log_Log_NE_18[c(-392, -177, -175),]
modelo_glm_Log_Log_NE_18<-glm(log(FLO_M)~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_Log_NE_18)
```
```{r}
#------------------------------------------------------------#
# Para rodar este programa deixe no objeto fit.model a saída      
# do ajuste da regressão com erros gama e ligação log.  Deixe     
# também os dados disponíveis através do comando attach(...).    
# Depois use o comando source(...) no R ou S-Plus para        
# executar o programa. A sequência de comandos é a seguinte:               
#
       fit.model <- modelo_glm_Log_Log_NE_18
       attach(Temporario)
       source("envel_gama.txt")                                      
#
# A saída será o gráfico de envelope para o resíduo componente 
# do desvio padronizado. Para colocar um título no gráfico use
# o comando title("..."). Para  usar  outras  ligações mudar 
# no programa abaixo o termo family=Gamma(link=log) para 
# family=Gamma no caso de ligação  recíproca ou por 
# family= Gamma(link=identity) no caso de ligação identidade.
#------------------------------------------------------------#
par(mfrow=c(1,1))
X <- model.matrix(fit.model)
n <- nrow(X)
p <- ncol(X)
w <- fit.model$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit.model,type="response")
fi <- (n-p)/sum((ro/(fitted(fit.model)))^ 2)
td <- resid(fit.model,type="deviance")*sqrt(fi/(1-h))
#
e <- matrix(0,n,100)
#
for(i in 1:100){
resp <- rgamma(n,fi)
resp <- (fitted(fit.model)/fi)*resp
fit <- glm(resp ~ X, family=Gamma(link=log))
w <- fit$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit,type="response")
phi <- (n-p)/sum((ro/(fitted(fit)))^ 2)
e[,i] <- sort(resid(fit,type="deviance")*sqrt(phi/(1-h)))}
#
e1 <- numeric(n)
e2 <- numeric(n)
#
for(i in 1:n){
  eo <- sort(e[i,])
e1[i] <- (eo[2]+eo[3])/2
e2[i] <- (eo[97]+eo[98])/2}
#
med <- apply(e,1,mean)
faixa <- range(td,e1,e2)
par(pty="s")
qqnorm(td, xlab="Percentil da N(0,1)",
ylab="Componente do Desvio", ylim=faixa, pch=16, main="")
par(new=TRUE)
#
qqnorm(e1,axes=F,xlab="",ylab="",type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(e2,axes=F,xlab="",ylab="", type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(med,axes=F,xlab="", ylab="", type="l",ylim=faixa,lty=2, main="")

#------------------------------------------------------------#          
```




## trandf. Log Log



```{r}
Temporario <- Nordeste[,c(-1,-3)] # retirando as vaiáveis REGIAO e ID_ENSAIO
modelo_glm_Log_2Log_NE_<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_2Log_NE_)
```
```{r}
fit.model<-modelo_glm_Log_2Log_NE_
m.C <- rbind(cbind(	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	)
)
testeF.CB(fit.model,m.C)
```

```{r}
Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("ALIANCA","BRS A704",    "BRS JABURU",   "CICA 8",   "EMPASC 101",    "EPAGRI 108",   "EPAGRI 109",  "MOXOTO", "PR268",   "SCS 114 ANDOSAN")

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_Log_2Log_NE_1<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_2Log_NE_1)
```


```{r}
fit.model<-modelo_glm_Log_2Log_NE_1
m.C <- rbind(cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	)
)
testeF.CB(fit.model,m.C)
```

```{r}
Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("BRS FORMOSO",   "BRS GUARA",   "IAC1298",  "IAC1299",    "PR267",   "SCS 116 SATORU",   "SCS 121 CL",    "SCSBRS 113 TIO TAKA")

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_Log_2Log_NE_2<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_2Log_NE_2)
```
```{r}
fit.model<-modelo_glm_Log_2Log_NE_2
m.C <- rbind(cbind(	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	)
)
testeF.CB(fit.model,m.C)
```

```{r}
Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("BRS ALVORADA",   "BRS CATIANA",  "IAC1307",   "OUROMINAS")

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_Log_2Log_NE_3<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_2Log_NE_3)
```
```{r}
fit.model<-modelo_glm_Log_2Log_NE_3
m.C <- rbind(cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	)

)
testeF.CB(fit.model,m.C)
```
```{r}
Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("BRS PAMPEIRA",  "BRSMG RUBELITA" )

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_Log_2Log_NE_4<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_2Log_NE_4)
```
Tmin_Media (p = 0.764462) 

```{r}
fit.model<-modelo_glm_Log_2Log_NE_4
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0
)
testeF.CB(fit.model,m.C)
```

```{r}
Temporario<- Temporario %>% select(-Tmin_Media)

modelo_glm_Log_2Log_NE_5<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_2Log_NE_5)
```

UR_fld_m (p = 0.665683) 

```{r}
fit.model<-modelo_glm_Log_2Log_NE_5
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0
)
testeF.CB(fit.model,m.C)
```

```{r}
Temporario<- Temporario %>% select(- UR_fld_m)

modelo_glm_Log_2Log_NE_6<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_2Log_NE_6)
```

Tmax_fld_m             5.217e-04  7.412e-04   0.704  (p = 0.481923) 

```{r}
fit.model<-modelo_glm_Log_2Log_NE_6
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,	0
)
testeF.CB(fit.model,m.C)
```

```{r}
Temporario<- Temporario %>% select(-Tmax_fld_m)

modelo_glm_Log_2Log_NE_7<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_2Log_NE_7)
```

Tmax_ACC_R (p = 0.445371) 

```{r}
fit.model<-modelo_glm_Log_2Log_NE_7
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	1,	0,	0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,	0
)
testeF.CB(fit.model,m.C)
```

```{r}
Temporario<- Temporario %>% select(- Tmax_ACC_R)

modelo_glm_Log_2Log_NE_8<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_2Log_NE_8)
```

Chuva_ACC  (p = 0.489730) 

```{r}
fit.model<-modelo_glm_Log_2Log_NE_8
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,		0,	0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,		0,	0,	0
)
testeF.CB(fit.model,m.C)
```

```{r}
Temporario<- Temporario %>% select(- Chuva_ACC)

modelo_glm_Log_2Log_NE_9<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_2Log_NE_9)
```

Tmax_Minima (p = 0.470961) 

```{r}
fit.model<-modelo_glm_Log_2Log_NE_9
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,		1,	0,	0,	0,	0,	0,		0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	0,	0,		0,	0,	0
)
testeF.CB(fit.model,m.C)
```

```{r}
Temporario<- Temporario %>% select(-Tmax_Minima)

modelo_glm_Log_2Log_NE_10<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_2Log_NE_10)
```

longitude (p = 0.233063) 

```{r}
fit.model<-modelo_glm_Log_2Log_NE_10
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,		0,			0,	0,	0,	0,	0,		0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	0,	0,		0,	0,	0
)
testeF.CB(fit.model,m.C)
```

```{r}
Temporario<- Temporario %>% select(-longitude)

modelo_glm_Log_2Log_NE_11<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_2Log_NE_11)
```

Rad_ACC_R (p = 0.244608) 

```{r}
fit.model<-modelo_glm_Log_2Log_NE_11
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,		0,			0,	0,	0,	0,	0,		0,	0,	0,	0,	0,		0,	0,	1,	0,	0,	0,	0,		0,	0,	0)
testeF.CB(fit.model,m.C)
```

```{r}
Temporario<- Temporario %>% select(-Rad_ACC_R)

modelo_glm_Log_2Log_NE_12<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_2Log_NE_12)
```

Rad_ACC  (p = 0.204519) 

```{r}
fit.model<-modelo_glm_Log_2Log_NE_12
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,		0,			0,	0,	0,	0,	0,		0,	0,	0,	0,	0,		0,	0,		1,	0,	0,	0,		0,	0,	0)
testeF.CB(fit.model,m.C)
```

```{r}
Temporario<- Temporario %>% select(- Rad_ACC)

modelo_glm_Log_2Log_NE_13<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_2Log_NE_13)
```

Tmax_Maxima (p = 0.242470) 

```{r}
fit.model<-modelo_glm_Log_2Log_NE_13
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	1,		0,			0,	0,	0,	0,	0,		0,	0,	0,	0,	0,		0,	0,			0,	0,	0,		0,	0,	0
)
testeF.CB(fit.model,m.C)
```

```{r}
Temporario<- Temporario %>% select(- Tmax_Maxima)

modelo_glm_Log_2Log_NE_14<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_2Log_NE_14)
```

Tmin_fld_m (p = 0.128733) 

```{r}
fit.model<-modelo_glm_Log_2Log_NE_14
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,			0,			0,	0,	0,	0,	0,		0,	0,	1,	0,	0,		0,	0,			0,	0,	0,		0,	0,	0
)
testeF.CB(fit.model,m.C)
```

```{r}
Temporario<- Temporario %>% select(-Tmin_fld_m)

modelo_glm_Log_2Log_NE_15<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_2Log_NE_15)
```
latitude  (p = 0.094561) 

```{r}
fit.model<-modelo_glm_Log_2Log_NE_15
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,		0,			0,			0,	0,	0,	0,	0,		0,	0,		0,	0,		0,	0,			0,	0,	0,		0,	0,	0
)
testeF.CB(fit.model,m.C)
```

```{r}
Temporario<- Temporario %>% select(-latitude)

modelo_glm_Log_2Log_NE_16<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_2Log_NE_16)
```
Graus_dia_ciclo (p = 0.094191)


```{r}
fit.model<-modelo_glm_Log_2Log_NE_16
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,			0,			0,			0,	0,	0,	0,	0,		0,	0,		0,	0,		0,	0,			0,	0,	0,		0,	1,	0
)
testeF.CB(fit.model,m.C)
```

```{r}
Temporario<- Temporario %>% select(-Graus_dia_ciclo)

modelo_glm_Log_2Log_NE_17<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_2Log_NE_17)
```
```{r}
Temporario_glm_Log_2Log_NE_17 <- Temporario
```


### Analise de residos.

```{r}
#------------------------------------------------------------#
# Para rodar este programa deixe no objeto fit.model a saída      
# do ajuste da regressão com erros gama e ligação log.  Deixe     
# também os dados disponíveis através do comando attach(...).    
# Depois use o comando source(...) no R ou S-Plus para        
# executar o programa. A sequência de comandos é a seguinte:               
#
       fit.model <- modelo_glm_Log_2Log_NE_17
       attach(Temporario_glm_Log_2Log_NE_17)
       source("envel_gama.txt")                                      
#
# A saída será o gráfico de envelope para o resíduo componente 
# do desvio padronizado. Para colocar um título no gráfico use
# o comando title("..."). Para  usar  outras  ligações mudar 
# no programa abaixo o termo family=Gamma(link=log) para 
# family=Gamma no caso de ligação  recíproca ou por 
# family= Gamma(link=identity) no caso de ligação identidade.
#------------------------------------------------------------#
par(mfrow=c(1,1))
X <- model.matrix(fit.model)
n <- nrow(X)
p <- ncol(X)
w <- fit.model$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit.model,type="response")
fi <- (n-p)/sum((ro/(fitted(fit.model)))^ 2)
td <- resid(fit.model,type="deviance")*sqrt(fi/(1-h))
#
e <- matrix(0,n,100)
#
for(i in 1:100){
resp <- rgamma(n,fi)
resp <- (fitted(fit.model)/fi)*resp
fit <- glm(resp ~ X, family=Gamma(link=log))
w <- fit$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit,type="response")
phi <- (n-p)/sum((ro/(fitted(fit)))^ 2)
e[,i] <- sort(resid(fit,type="deviance")*sqrt(phi/(1-h)))}
#
e1 <- numeric(n)
e2 <- numeric(n)
#
for(i in 1:n){
  eo <- sort(e[i,])
e1[i] <- (eo[2]+eo[3])/2
e2[i] <- (eo[97]+eo[98])/2}
#
med <- apply(e,1,mean)
faixa <- range(td,e1,e2)
par(pty="s")
qqnorm(td, xlab="Percentil da N(0,1)",
ylab="Componente do Desvio", ylim=faixa, pch=16, main="")
par(new=TRUE)
#
qqnorm(e1,axes=F,xlab="",ylab="",type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(e2,axes=F,xlab="",ylab="", type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(med,axes=F,xlab="", ylab="", type="l",ylim=faixa,lty=2, main="")

#------------------------------------------------------------#          
```

```{r}
#------------------------------------------------------------#
# Para rodar este programa  deixe no objeto fit.model a saída 
# do  ajuste  da  regressão com  erros gama.   Deixe  os dados 
# disponíveis  através do comando attach(...). Depois  use  o 
# comando source(...) no S-Plus ou R para executar o programa. 
# A sequência de comandos é a seguinte:
#
         fit.model <- modelo_glm_Log_2Log_NE_17
         attach(Temporario_glm_Log_2Log_NE_17)
         source("diag_gama.txt")
#
# A saída terá quatro gráficos: de pontos de alacanca, 
# de pontos influentes  e  dois de resíduos. Para 
# identificar os pontos que  mais  se destacam usar o 
# comando identify(...). Se por exemplo se destacam
# três pontos no plot(fitted(fit.model),h,...), 
# após esse comando coloque
#     
#        > identify(fitted(fit.model),h,n=3)
#
# O mesmo pode ser feito nos demais gráficos. Nos gráficos de 
# resíduos foram colocados os limites ylim=c(a-1,b+1), 
# em que a é o menor valor e b o maior valor para o resíduo. 
# Este programa usa a library MASS para estimar o parâmetro
# fi da gama que  estará guardado no objeto fi.
#------------------------------------------------------------#
X <- model.matrix(fit.model)
n <- nrow(X)
p <- ncol(X)
w <- fit.model$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
library(MASS)
fi <- gamma.shape(fit.model)$alpha
ts <- resid(fit.model,type="pearson")*sqrt(fi/(1-h))
td <- resid(fit.model,type="deviance")*sqrt(fi/(1-h))
di <- (h/(1-h))*(ts^2)
par(mfrow=c(2,2))
a <- max(td)
b <- min(td)
plot(fitted(fit.model),h,xlab="Valor Ajustado", ylab="Medida h", pch=16)
#identify(fitted(fit.model), h, n=1)
#
plot(di,xlab="Índice", ylab="Distância de Cook", pch=16)
#identify(di, n=2)
#
plot(fitted(fit.model),td,xlab="Valor Ajustado", ylab="Resíduo Componente do Desvio",
ylim=c(b-1,a+1),pch=16)
abline(2,0,lty=2)
abline(-2,0,lty=2)
#identify(fitted(fit.model),td, n=1)
#
w <- fit.model$weights
eta <- predict(fit.model)
z <- eta + resid(fit.model, type="pearson")/sqrt(w)
plot(predict(fit.model),z,xlab="Preditor Linear", 
ylab="Variável z", pch=16)
par(mfrow=c(1,1))
#------------------------------------------------------------#

```

```{r}
 detach("package:MASS", unload = TRUE)
```

### Retirando linhas

```{r}
teste<-td
teste1 <- sort(teste)
match(teste1[1:3], teste)
```

```{r}
Temporario<-Temporario_glm_Log_2Log_NE_17[c(-392, -177, -175),]
modelo_glm_Log_2Log_NE_18<-glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "log" ))
summary(modelo_glm_Log_2Log_NE_18)
```
```{r}
#------------------------------------------------------------#
# Para rodar este programa deixe no objeto fit.model a saída      
# do ajuste da regressão com erros gama e ligação log.  Deixe     
# também os dados disponíveis através do comando attach(...).    
# Depois use o comando source(...) no R ou S-Plus para        
# executar o programa. A sequência de comandos é a seguinte:               
#
       fit.model <- modelo_glm_Log_2Log_NE_18
       attach(Temporario)
       source("envel_gama.txt")                                      
#
# A saída será o gráfico de envelope para o resíduo componente 
# do desvio padronizado. Para colocar um título no gráfico use
# o comando title("..."). Para  usar  outras  ligações mudar 
# no programa abaixo o termo family=Gamma(link=log) para 
# family=Gamma no caso de ligação  recíproca ou por 
# family= Gamma(link=identity) no caso de ligação identidade.
#------------------------------------------------------------#
par(mfrow=c(1,1))
X <- model.matrix(fit.model)
n <- nrow(X)
p <- ncol(X)
w <- fit.model$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit.model,type="response")
fi <- (n-p)/sum((ro/(fitted(fit.model)))^ 2)
td <- resid(fit.model,type="deviance")*sqrt(fi/(1-h))
#
e <- matrix(0,n,100)
#
for(i in 1:100){
resp <- rgamma(n,fi)
resp <- (fitted(fit.model)/fi)*resp
fit <- glm(resp ~ X, family=Gamma(link=log))
w <- fit$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit,type="response")
phi <- (n-p)/sum((ro/(fitted(fit)))^ 2)
e[,i] <- sort(resid(fit,type="deviance")*sqrt(phi/(1-h)))}
#
e1 <- numeric(n)
e2 <- numeric(n)
#
for(i in 1:n){
  eo <- sort(e[i,])
e1[i] <- (eo[2]+eo[3])/2
e2[i] <- (eo[97]+eo[98])/2}
#
med <- apply(e,1,mean)
faixa <- range(td,e1,e2)
par(pty="s")
qqnorm(td, xlab="Percentil da N(0,1)",
ylab="Componente do Desvio", ylim=faixa, pch=16, main="")
par(new=TRUE)
#
qqnorm(e1,axes=F,xlab="",ylab="",type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(e2,axes=F,xlab="",ylab="", type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(med,axes=F,xlab="", ylab="", type="l",ylim=faixa,lty=2, main="")

#------------------------------------------------------------#          
```






#2) LINK inverse

```{r}
Temporario<-Nordeste[,c(-1,-3)]
modelo_glm_inv_NE_<- glm(FLO_M~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_inv_NE_)
```

Tmax_ACC_R (p = 0.786921)

```{r}
fit.model<-modelo_glm_inv_NE_
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmax_ACC_R)
modelo_glm_inv_NE_1<- glm(FLO_M~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_inv_NE_1)
```

Tmin_Media (p = 0.663388)

```{r}
fit.model<-modelo_glm_inv_NE_1
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmin_Media)
modelo_glm_inv_NE_2<- glm(FLO_M~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_inv_NE_2)
```

Chuva_ACC (p = 0.613085)

```{r}
fit.model<-modelo_glm_inv_NE_2
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Chuva_ACC)
modelo_glm_inv_NE_3<- glm(FLO_M~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_inv_NE_3)
```

Tmax_fld_m (p = 0.608732)

```{r}
fit.model<-modelo_glm_inv_NE_3
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,		0,	0,	0,	0,	0,	0,		0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmax_fld_m)
modelo_glm_inv_NE_4<- glm(FLO_M~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_inv_NE_4)
```

Tmin_fld_m (p = 0.604901)

```{r}
fit.model<-modelo_glm_inv_NE_4
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,		0,	0,	0,	0,	0,	0,		0,	0,	1,	0,	0,		0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmin_fld_m)
modelo_glm_inv_NE_5<- glm(FLO_M~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_inv_NE_5)
```

longitude (p = 0.404342)

```{r}
fit.model<-modelo_glm_inv_NE_5
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,		0,		0,	0,	0,	0,	0,	0,		0,	0,		0,	0,		0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-longitude)
modelo_glm_inv_NE_6<- glm(FLO_M~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_inv_NE_6)
```

Tmax_Minima  (p = 0.274949)

```{r}
fit.model<-modelo_glm_inv_NE_6
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,		0,		1,	0,	0,	0,	0,	0,		0,	0,		0,	0,		0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmax_Minima)
modelo_glm_inv_NE_7<- glm(FLO_M~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_inv_NE_7)
```

UR_fld_m (p = 0.219546)

```{r}
fit.model<-modelo_glm_inv_NE_7
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,		0,			0,	0,	0,	0,	0,		0,	0,		0,	0,		0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-UR_fld_m)
modelo_glm_inv_NE_8<- glm(FLO_M~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_inv_NE_8)
```

Rad_ACC_R (p = 0.194535)

```{r}
fit.model<-modelo_glm_inv_NE_8
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,		0,			0,	0,	0,	0,	0,		0,	0,		0,	0,		0,	0,	1,	0,	0,	0,	0,		0,	0,	0)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Rad_ACC_R)
modelo_glm_inv_NE_9<- glm(FLO_M~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_inv_NE_9)
```

Tmax_Maxima (p = 0.239202)

```{r}
fit.model<-modelo_glm_inv_NE_9
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	1,		0,			0,	0,	0,	0,	0,		0,	0,		0,	0,		0,	0,		0,	0,	0,	0,		0,	0,	0)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmax_Maxima)
modelo_glm_inv_NE_10<- glm(FLO_M~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_inv_NE_10)
```

UR_V (p = 0.096285)

```{r}
fit.model<-modelo_glm_inv_NE_10
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,			0,			0,	0,	0,	0,	0,		0,	0,		0,	0,		0,	0,		0,	0,	0,	1,		0,	0,	0)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-UR_V)
modelo_glm_inv_NE_11<- glm(FLO_M~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_inv_NE_11)
```

Tmin_Maxima  (p = 0.073321)

```{r}
fit.model<-modelo_glm_inv_NE_11
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,			0,			0,	0,	0,	1,	0,		0,	0,		0,	0,		0,	0,		0,	0,	0,			0,	0,	0)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmin_Maxima)
modelo_glm_inv_NE_12<- glm(FLO_M~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_inv_NE_12)
```

Genótipos não significativos 

```{r}
fit.model<-modelo_glm_inv_NE_12
m.C <-rbind(cbind(	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	))
testeF.CB(fit.model,m.C)
```

Genótipo "ALIANCA" está no intercepto
```{r}

Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("ALIANCA", "BRS A704",    "BRS JABURU",   "CICA 8",   "EPAGRI 108",  "EPAGRI 109",  "MOXOTO",  "PR268","EMPASC 101" )

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_inv_NE_13<- glm(FLO_M~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_inv_NE_13)
```



```{r}
fit.model<-modelo_glm_inv_NE_13
m.C <- rbind(cbind(	0,	0,	0,	0,	0,	0,	0,		0,	0,	0,	1,	0,	0,		0,	0,	0,	0,	0,		0,	0,	0,		0,			0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,		0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	1,		0,	0,	0,	0,	0,		0,	0,	0,		0,			0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,		0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	0,		0,	0,	0,	0,	0,		0,	0,	0,		0,			0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,		0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	0,		0,	0,	0,	0,	0,		0,	0,	0,		0,			0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,		0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	0,		0,	0,	0,	0,	0,		0,	0,	0,		0,			0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,		0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	))
testeF.CB(fit.model,m.C)
```
```{r}
Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("BRS FORMOSO",   "BRS GUARA",  "SCS 121 CL",   "SCS 116 SATORU",    "SCS 114 ANDOSAN" )

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_inv_NE_14<- glm(FLO_M~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_inv_NE_14)
```

```{r}
fit.model<-modelo_glm_inv_NE_14
m.C <- rbind(cbind(	0,	0,	0,	0,	0,	0,	0,		0,	0,	0,		0,			0,	0,	0,	0,	0,		0,	0,	0,		0,			1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,		0,	0,	0,	0,	0,				0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,		0,	0,	0,		0,			0,	0,	0,	0,	0,		0,	0,	0,		0,			0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,		0,	0,	0,	0,	0,				0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,		0,	0,	0,		0,			0,	0,	0,	0,	0,		0,	0,	0,		0,			0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	1,		0,	0,	0,	0,	0,				0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,		0,	0,	0,		0,			0,	0,	0,	0,	0,		0,	0,	0,		0,			0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,		0,	0,	0,	0,	0,				0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	))
testeF.CB(fit.model,m.C)
```

```{r}
Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("IAC1298",  "IAC1299",   "PR267",  "SCSBRS 113 TIO TAKA" )

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_inv_NE_15<- glm(FLO_M~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_inv_NE_15)
```


```{r}
fit.model<-modelo_glm_inv_NE_15
m.C <- rbind(cbind(	0,	0,	0,	0,	0,	0,	0,		1,	0,	0,		0,			0,	0,	0,	0,	0,		0,	0,	0,		0,					0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,			0,	0,	0,	0,	0,				0,		0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,		0,	0,	1,		0,			0,	0,	0,	0,	0,		0,	0,	0,		0,					0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,			0,	0,	0,	0,	0,				0,		0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,		0,	0,	0,		0,			0,	0,	0,	0,	0,		0,	0,	0,		0,					0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		1,			0,	0,	0,	0,	0,				0,		0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	))
testeF.CB(fit.model,m.C)
```

```{r}
Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("BRS ALVORADA","BRS CATIANA","OUROMINAS")

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_inv_NE_16<- glm(FLO_M~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_inv_NE_16)
```
```{r}
fit.model<-modelo_glm_inv_NE_16
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,			0,			0,			0,	0,	0,	0,	1,		0,	0,	0,		0,					0,	0,	0,	0,	0,	0,	0,	0,	0,	0,					0,	0,	0,	0,	0,				0,		0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	)
testeF.CB(fit.model,m.C)
```

```{r}
Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("BRSMG RUBELITA")

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_inv_NE_17<- glm(FLO_M~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_inv_NE_17)
```

latitude (p = 0.173634) 
```{r}
fit.model<-modelo_glm_inv_NE_17
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,			0,			0,			0,	0,	0,	0,			0,	0,	0,		0,					0,	0,	0,	0,	0,	0,	0,	0,	0,	0,					0,	0,	0,	0,	0,				0,		1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-latitude)
modelo_glm_inv_NE_18<- glm(FLO_M~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_inv_NE_18)
```

```{r}
fit.model<-modelo_glm_inv_NE_18
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,			0,			0,			0,	0,	0,	0,			0,	0,	0,		0,					1,	0,	0,	0,	0,	0,	0,	0,	0,	0,					0,	0,	0,	0,	0,				0,			0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	)
testeF.CB(fit.model,m.C)
```

```{r}
Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("IAC1307")

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_inv_NE_19<- glm(FLO_M~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_inv_NE_19)
```


```{r}
fit.model<-modelo_glm_inv_NE_19
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,			0,			0,			0,	0,	1,	0,			0,	0,	0,		0,						0,	0,	0,	0,	0,	0,	0,	0,	0,					0,	0,	0,	0,	0,				0,			0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	)
testeF.CB(fit.model,m.C)
```

```{r}
Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("BRS PAMPEIRA")

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_inv_NE_20<- glm(FLO_M~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_inv_NE_20)
```
Rad_ACC_V  (p = 0.050638) .

```{r}
fit.model<-modelo_glm_inv_NE_20
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,			0,			0,			0,	0,		0,			0,	0,	0,		0,						0,	0,	0,	0,	0,	0,	0,	0,	0,					0,	0,	0,	0,	0,				0,			0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Rad_ACC_V)
modelo_glm_inv_NE_21<- glm(FLO_M~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_inv_NE_21)
```
```{r}
Temporario_glm_inv_NE_21<- Temporario
```


## Analise de residos.

```{r}
#------------------------------------------------------------#
# Para rodar este programa deixe no objeto fit.model a saída      
# do ajuste da regressão com erros gama e ligação log.  Deixe     
# também os dados disponíveis através do comando attach(...).    
# Depois use o comando source(...) no R ou S-Plus para        
# executar o programa. A sequência de comandos é a seguinte:               
#
       fit.model <- modelo_glm_inv_NE_21
       attach(Temporario_glm_inv_NE_21)
       source("envel_gama.txt")                                      
#
# A saída será o gráfico de envelope para o resíduo componente 
# do desvio padronizado. Para colocar um título no gráfico use
# o comando title("..."). Para  usar  outras  ligações mudar 
# no programa abaixo o termo family=Gamma(link=log) para 
# family=Gamma no caso de ligação  recíproca ou por 
# family= Gamma(link=identity) no caso de ligação identidade.
#------------------------------------------------------------#
par(mfrow=c(1,1))
X <- model.matrix(fit.model)
n <- nrow(X)
p <- ncol(X)
w <- fit.model$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit.model,type="response")
fi <- (n-p)/sum((ro/(fitted(fit.model)))^ 2)
td <- resid(fit.model,type="deviance")*sqrt(fi/(1-h))
#
e <- matrix(0,n,100)
#
for(i in 1:100){
resp <- rgamma(n,fi)
resp <- (fitted(fit.model)/fi)*resp
fit <- glm(resp ~ X, family=Gamma(link=log))
w <- fit$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit,type="response")
phi <- (n-p)/sum((ro/(fitted(fit)))^ 2)
e[,i] <- sort(resid(fit,type="deviance")*sqrt(phi/(1-h)))}
#
e1 <- numeric(n)
e2 <- numeric(n)
#
for(i in 1:n){
  eo <- sort(e[i,])
e1[i] <- (eo[2]+eo[3])/2
e2[i] <- (eo[97]+eo[98])/2}
#
med <- apply(e,1,mean)
faixa <- range(td,e1,e2)
par(pty="s")
qqnorm(td, xlab="Percentil da N(0,1)",
ylab="Componente do Desvio", ylim=faixa, pch=16, main="")
par(new=TRUE)
#
qqnorm(e1,axes=F,xlab="",ylab="",type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(e2,axes=F,xlab="",ylab="", type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(med,axes=F,xlab="", ylab="", type="l",ylim=faixa,lty=2, main="")

#------------------------------------------------------------#          
```

```{r}
#------------------------------------------------------------#
# Para rodar este programa  deixe no objeto fit.model a saída 
# do  ajuste  da  regressão com  erros gama.   Deixe  os dados 
# disponíveis  através do comando attach(...). Depois  use  o 
# comando source(...) no S-Plus ou R para executar o programa. 
# A sequência de comandos é a seguinte:
#
         fit.model <- modelo_glm_inv_NE_21
         attach(Temporario_glm_inv_NE_21)
         source("diag_gama.txt")
#
# A saída terá quatro gráficos: de pontos de alacanca, 
# de pontos influentes  e  dois de resíduos. Para 
# identificar os pontos que  mais  se destacam usar o 
# comando identify(...). Se por exemplo se destacam
# três pontos no plot(fitted(fit.model),h,...), 
# após esse comando coloque
#     
#        > identify(fitted(fit.model),h,n=3)
#
# O mesmo pode ser feito nos demais gráficos. Nos gráficos de 
# resíduos foram colocados os limites ylim=c(a-1,b+1), 
# em que a é o menor valor e b o maior valor para o resíduo. 
# Este programa usa a library MASS para estimar o parâmetro
# fi da gama que  estará guardado no objeto fi.
#------------------------------------------------------------#
X <- model.matrix(fit.model)
n <- nrow(X)
p <- ncol(X)
w <- fit.model$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
library(MASS)
fi <- gamma.shape(fit.model)$alpha
ts <- resid(fit.model,type="pearson")*sqrt(fi/(1-h))
td <- resid(fit.model,type="deviance")*sqrt(fi/(1-h))
di <- (h/(1-h))*(ts^2)
par(mfrow=c(2,2))
a <- max(td)
b <- min(td)
plot(fitted(fit.model),h,xlab="Valor Ajustado", ylab="Medida h", pch=16)
#identify(fitted(fit.model), h, n=1)
#
plot(di,xlab="Índice", ylab="Distância de Cook", pch=16)
#identify(di, n=2)
#
plot(fitted(fit.model),td,xlab="Valor Ajustado", ylab="Resíduo Componente do Desvio",
ylim=c(b-1,a+1),pch=16)
abline(2,0,lty=2)
abline(-2,0,lty=2)
#identify(fitted(fit.model),td, n=1)
#
w <- fit.model$weights
eta <- predict(fit.model)
z <- eta + resid(fit.model, type="pearson")/sqrt(w)
plot(predict(fit.model),z,xlab="Preditor Linear", 
ylab="Variável z", pch=16)
par(mfrow=c(1,1))
#------------------------------------------------------------#

```

```{r}
 detach("package:MASS", unload = TRUE)
```

## Retirando linhas

```{r}
teste<-td
teste1 <- sort(teste)
match(teste1[1:3], teste)
```

```{r}
Temporario<-Temporario_glm_inv_NE_21[c(-392, -177, -175),]
modelo_glm_inv_NE_22<-glm(FLO_M~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_inv_NE_22)
```
```{r}
#------------------------------------------------------------#
# Para rodar este programa deixe no objeto fit.model a saída      
# do ajuste da regressão com erros gama e ligação log.  Deixe     
# também os dados disponíveis através do comando attach(...).    
# Depois use o comando source(...) no R ou S-Plus para        
# executar o programa. A sequência de comandos é a seguinte:               
#
       fit.model <- modelo_glm_inv_NE_22
       attach(Temporario)
       source("envel_gama.txt")                                      
#
# A saída será o gráfico de envelope para o resíduo componente 
# do desvio padronizado. Para colocar um título no gráfico use
# o comando title("..."). Para  usar  outras  ligações mudar 
# no programa abaixo o termo family=Gamma(link=log) para 
# family=Gamma no caso de ligação  recíproca ou por 
# family= Gamma(link=identity) no caso de ligação identidade.
#------------------------------------------------------------#
par(mfrow=c(1,1))
X <- model.matrix(fit.model)
n <- nrow(X)
p <- ncol(X)
w <- fit.model$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit.model,type="response")
fi <- (n-p)/sum((ro/(fitted(fit.model)))^ 2)
td <- resid(fit.model,type="deviance")*sqrt(fi/(1-h))
#
e <- matrix(0,n,100)
#
for(i in 1:100){
resp <- rgamma(n,fi)
resp <- (fitted(fit.model)/fi)*resp
fit <- glm(resp ~ X, family=Gamma(link=log))
w <- fit$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit,type="response")
phi <- (n-p)/sum((ro/(fitted(fit)))^ 2)
e[,i] <- sort(resid(fit,type="deviance")*sqrt(phi/(1-h)))}
#
e1 <- numeric(n)
e2 <- numeric(n)
#
for(i in 1:n){
  eo <- sort(e[i,])
e1[i] <- (eo[2]+eo[3])/2
e2[i] <- (eo[97]+eo[98])/2}
#
med <- apply(e,1,mean)
faixa <- range(td,e1,e2)
par(pty="s")
qqnorm(td, xlab="Percentil da N(0,1)",
ylab="Componente do Desvio", ylim=faixa, pch=16, main="")
par(new=TRUE)
#
qqnorm(e1,axes=F,xlab="",ylab="",type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(e2,axes=F,xlab="",ylab="", type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(med,axes=F,xlab="", ylab="", type="l",ylim=faixa,lty=2, main="")

#------------------------------------------------------------#          
```


## Transf. log

```{r}
Temporario<-Nordeste[,c(-1,-3)]
modelo_glm_Log_inv_NE_<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_Log_inv_NE_)
```


```{r}
fit.model<-modelo_glm_Log_inv_NE_
m.C <- cbind()
testeF.CB(fit.model,m.C)
```

```{r}
Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("ALIANCA", "BRS A704","BRS JABURU","CICA 8","EMPASC 101","EPAGRI 108","EPAGRI 109","MOXOTO","PR268","SCS 114 ANDOSAN")

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_Log_inv_NE_2<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_Log_inv_NE_2)
```



```{r}
fit.model<-modelo_glm_Log_inv_NE_2
m.C <- cbind()
testeF.CB(fit.model,m.C)
```

```{r}
Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("BRS FORMOSO","BRS GUARA", "IAC1298", "IAC1299"  ,"PR267","SCS 116 SATORU","SCS 121 CL","SCSBRS 113 TIO TAKA")

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_Log_inv_NE_3<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_Log_inv_NE_3)
```




```{r}
fit.model<-modelo_glm_Log_inv_NE_3
m.C <- cbind()
testeF.CB(fit.model,m.C)
```

```{r}
Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c( "BRS ALVORADA","BRS CATIANA" , "IAC1307"   , "OUROMINAS")

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_Log_inv_NE_4<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_Log_inv_NE_4)
```
```{r}
fit.model<-modelo_glm_Log_inv_NE_4
m.C <- cbind()
testeF.CB(fit.model,m.C)
```

```{r}
Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("BRS PAMPEIRA" ,"BRSMG RUBELITA" )

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_Log_inv_NE_5<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_Log_inv_NE_5)
```
Tmin_Media (p = 0.811783)

```{r}
fit.model<-modelo_glm_Log_inv_NE_5
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmin_Media)
modelo_glm_Log_inv_NE_6<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_Log_inv_NE_6)
```

UR_fld_m  (p = 0.811783)

```{r}
fit.model<-modelo_glm_Log_inv_NE_6
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-UR_fld_m)
modelo_glm_Log_inv_NE_7<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_Log_inv_NE_7)
```


Chuva_ACC (p = 0.451156)

```{r}
fit.model<-modelo_glm_Log_inv_NE_7
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Chuva_ACC)
modelo_glm_Log_inv_NE_8<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_Log_inv_NE_8)
```


Tmax_ACC_R  (p = 0.445012)

```{r}
fit.model<-modelo_glm_Log_inv_NE_8
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmax_ACC_R)
modelo_glm_Log_inv_NE_9<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_Log_inv_NE_9)
```


Tmax_fld_m (p = 0.475657)

```{r}
fit.model<-modelo_glm_Log_inv_NE_9
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmax_fld_m)
modelo_glm_Log_inv_NE_10<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_Log_inv_NE_10)
```


Tmax_Minima (p = 0.451635)

```{r}
fit.model<-modelo_glm_Log_inv_NE_10
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmax_Minima)
modelo_glm_Log_inv_NE_11<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_Log_inv_NE_11)
```


longitude (p = 0.246003)

```{r}
fit.model<-modelo_glm_Log_inv_NE_11
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-longitude)
modelo_glm_Log_inv_NE_12<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_Log_inv_NE_12)
```


Rad_ACC_R (p = 0.246329)

```{r}
fit.model<-modelo_glm_Log_inv_NE_12
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Rad_ACC_R)
modelo_glm_Log_inv_NE_13<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_Log_inv_NE_13)
```


Rad_ACC (p = 0.190956)

```{r}
fit.model<-modelo_glm_Log_inv_NE_13
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Rad_ACC)
modelo_glm_Log_inv_NE_14<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_Log_inv_NE_14)
```


Tmax_Maxima (p = 0.224213)

```{r}
fit.model<-modelo_glm_Log_inv_NE_14
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmax_Maxima)
modelo_glm_Log_inv_NE_15<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_Log_inv_NE_15)
```


Tmin_fld_m  (p = 0.121036)

```{r}
fit.model<-modelo_glm_Log_inv_NE_15
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmin_fld_m)
modelo_glm_Log_inv_NE_16<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_Log_inv_NE_16)
```


latitude (p = 0.093196)

```{r}
fit.model<-modelo_glm_Log_inv_NE_16
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-latitude)
modelo_glm_Log_inv_NE_17<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_Log_inv_NE_17)
```


Graus_dia_ciclo (p = 0.084563)

```{r}
fit.model<-modelo_glm_Log_inv_NE_17
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Graus_dia_ciclo)
modelo_glm_Log_inv_NE_18<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_Log_inv_NE_18)
```

```{r}
Temporario_glm_Log_inv_NE_18 <- Temporario
```


#### Analise de residos.

```{r}
#------------------------------------------------------------#
# Para rodar este programa deixe no objeto fit.model a saída      
# do ajuste da regressão com erros gama e ligação log.  Deixe     
# também os dados disponíveis através do comando attach(...).    
# Depois use o comando source(...) no R ou S-Plus para        
# executar o programa. A sequência de comandos é a seguinte:               
#
       fit.model <- modelo_glm_Log_inv_NE_18
       attach(Temporario_glm_Log_inv_NE_18)
       source("envel_gama.txt")                                      
#
# A saída será o gráfico de envelope para o resíduo componente 
# do desvio padronizado. Para colocar um título no gráfico use
# o comando title("..."). Para  usar  outras  ligações mudar 
# no programa abaixo o termo family=Gamma(link=log) para 
# family=Gamma no caso de ligação  recíproca ou por 
# family= Gamma(link=identity) no caso de ligação identidade.
#------------------------------------------------------------#
par(mfrow=c(1,1))
X <- model.matrix(fit.model)
n <- nrow(X)
p <- ncol(X)
w <- fit.model$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit.model,type="response")
fi <- (n-p)/sum((ro/(fitted(fit.model)))^ 2)
td <- resid(fit.model,type="deviance")*sqrt(fi/(1-h))
#
e <- matrix(0,n,100)
#
for(i in 1:100){
resp <- rgamma(n,fi)
resp <- (fitted(fit.model)/fi)*resp
fit <- glm(resp ~ X, family=Gamma(link=log))
w <- fit$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit,type="response")
phi <- (n-p)/sum((ro/(fitted(fit)))^ 2)
e[,i] <- sort(resid(fit,type="deviance")*sqrt(phi/(1-h)))}
#
e1 <- numeric(n)
e2 <- numeric(n)
#
for(i in 1:n){
  eo <- sort(e[i,])
e1[i] <- (eo[2]+eo[3])/2
e2[i] <- (eo[97]+eo[98])/2}
#
med <- apply(e,1,mean)
faixa <- range(td,e1,e2)
par(pty="s")
qqnorm(td, xlab="Percentil da N(0,1)",
ylab="Componente do Desvio", ylim=faixa, pch=16, main="")
par(new=TRUE)
#
qqnorm(e1,axes=F,xlab="",ylab="",type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(e2,axes=F,xlab="",ylab="", type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(med,axes=F,xlab="", ylab="", type="l",ylim=faixa,lty=2, main="")

#------------------------------------------------------------#          
```

```{r}
#------------------------------------------------------------#
# Para rodar este programa  deixe no objeto fit.model a saída 
# do  ajuste  da  regressão com  erros gama.   Deixe  os dados 
# disponíveis  através do comando attach(...). Depois  use  o 
# comando source(...) no S-Plus ou R para executar o programa. 
# A sequência de comandos é a seguinte:
#
         fit.model <- modelo_glm_Log_inv_NE_18
         attach(Temporario_glm_Log_inv_NE_18)
         source("diag_gama.txt")
#
# A saída terá quatro gráficos: de pontos de alacanca, 
# de pontos influentes  e  dois de resíduos. Para 
# identificar os pontos que  mais  se destacam usar o 
# comando identify(...). Se por exemplo se destacam
# três pontos no plot(fitted(fit.model),h,...), 
# após esse comando coloque
#     
#        > identify(fitted(fit.model),h,n=3)
#
# O mesmo pode ser feito nos demais gráficos. Nos gráficos de 
# resíduos foram colocados os limites ylim=c(a-1,b+1), 
# em que a é o menor valor e b o maior valor para o resíduo. 
# Este programa usa a library MASS para estimar o parâmetro
# fi da gama que  estará guardado no objeto fi.
#------------------------------------------------------------#
X <- model.matrix(fit.model)
n <- nrow(X)
p <- ncol(X)
w <- fit.model$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
library(MASS)
fi <- gamma.shape(fit.model)$alpha
ts <- resid(fit.model,type="pearson")*sqrt(fi/(1-h))
td <- resid(fit.model,type="deviance")*sqrt(fi/(1-h))
di <- (h/(1-h))*(ts^2)
par(mfrow=c(2,2))
a <- max(td)
b <- min(td)
plot(fitted(fit.model),h,xlab="Valor Ajustado", ylab="Medida h", pch=16)
#identify(fitted(fit.model), h, n=1)
#
plot(di,xlab="Índice", ylab="Distância de Cook", pch=16)
#identify(di, n=2)
#
plot(fitted(fit.model),td,xlab="Valor Ajustado", ylab="Resíduo Componente do Desvio",
ylim=c(b-1,a+1),pch=16)
abline(2,0,lty=2)
abline(-2,0,lty=2)
#identify(fitted(fit.model),td, n=1)
#
w <- fit.model$weights
eta <- predict(fit.model)
z <- eta + resid(fit.model, type="pearson")/sqrt(w)
plot(predict(fit.model),z,xlab="Preditor Linear", 
ylab="Variável z", pch=16)
par(mfrow=c(1,1))
#------------------------------------------------------------#

```

```{r}
 detach("package:MASS", unload = TRUE)
```

### Removendo linhas

```{r}
teste<-td
teste1 <- sort(teste)
match(teste1[1:3], teste)
```

```{r}
Temporario<-Temporario_glm_Log_inv_NE_18[c(-392, -177, -175),]
modelo_glm_Log_inv_NE_19<-glm(log(FLO_M)~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_Log_inv_NE_19)
```
```{r}
#------------------------------------------------------------#
# Para rodar este programa deixe no objeto fit.model a saída      
# do ajuste da regressão com erros gama e ligação log.  Deixe     
# também os dados disponíveis através do comando attach(...).    
# Depois use o comando source(...) no R ou S-Plus para        
# executar o programa. A sequência de comandos é a seguinte:               
#
       fit.model <- modelo_glm_Log_inv_NE_19
       attach(Temporario)
       source("envel_gama.txt")                                      
#
# A saída será o gráfico de envelope para o resíduo componente 
# do desvio padronizado. Para colocar um título no gráfico use
# o comando title("..."). Para  usar  outras  ligações mudar 
# no programa abaixo o termo family=Gamma(link=log) para 
# family=Gamma no caso de ligação  recíproca ou por 
# family= Gamma(link=identity) no caso de ligação identidade.
#------------------------------------------------------------#
par(mfrow=c(1,1))
X <- model.matrix(fit.model)
n <- nrow(X)
p <- ncol(X)
w <- fit.model$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit.model,type="response")
fi <- (n-p)/sum((ro/(fitted(fit.model)))^ 2)
td <- resid(fit.model,type="deviance")*sqrt(fi/(1-h))
#
e <- matrix(0,n,100)
#
for(i in 1:100){
resp <- rgamma(n,fi)
resp <- (fitted(fit.model)/fi)*resp
fit <- glm(resp ~ X, family=Gamma(link=log))
w <- fit$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit,type="response")
phi <- (n-p)/sum((ro/(fitted(fit)))^ 2)
e[,i] <- sort(resid(fit,type="deviance")*sqrt(phi/(1-h)))}
#
e1 <- numeric(n)
e2 <- numeric(n)
#
for(i in 1:n){
  eo <- sort(e[i,])
e1[i] <- (eo[2]+eo[3])/2
e2[i] <- (eo[97]+eo[98])/2}
#
med <- apply(e,1,mean)
faixa <- range(td,e1,e2)
par(pty="s")
qqnorm(td, xlab="Percentil da N(0,1)",
ylab="Componente do Desvio", ylim=faixa, pch=16, main="")
par(new=TRUE)
#
qqnorm(e1,axes=F,xlab="",ylab="",type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(e2,axes=F,xlab="",ylab="", type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(med,axes=F,xlab="", ylab="", type="l",ylim=faixa,lty=2, main="")

#------------------------------------------------------------#          
```

## Transf. log log



```{r}
Temporario<-Nordeste[,c(-1,-3)]
modelo_glm_Log_log_inv_NE_<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_Log_log_inv_NE_)
```
```{r}
fit.model<-modelo_glm_Log_log_inv_NE_
m.C <- cbind()
testeF.CB(fit.model,m.C)
```

```{r}
Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("ALIANCA", "BRS A704", "BRS JABURU","CICA 8","EMPASC 101","EPAGRI 108", "EPAGRI 109", "MOXOTO", "PR268", "SCS 114 ANDOSAN")

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_Log_log_inv_NE_1<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_Log_log_inv_NE_1)
```

```{r}
fit.model<-modelo_glm_Log_log_inv_NE_1
m.C <- cbind()
testeF.CB(fit.model,m.C)
```

```{r}
Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("BRS FORMOSO", "BRS GUARA", "IAC1298","IAC1299", "PR267", "SCS 116 SATORU", "SCS 121 CL", "SCSBRS 113 TIO TAKA")

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_Log_log_inv_NE_2<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_Log_log_inv_NE_2)
```
```{r}
fit.model<-modelo_glm_Log_log_inv_NE_2
m.C <- cbind()
testeF.CB(fit.model,m.C)
```

```{r}
Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("BRS ALVORADA"  , "BRS CATIANA", "IAC1307" ,"OUROMINAS")

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_Log_log_inv_NE_3<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_Log_log_inv_NE_3)
```
```{r}
fit.model<-modelo_glm_Log_log_inv_NE_3
m.C <- cbind()
testeF.CB(fit.model,m.C)
```

```{r}
Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("BRS PAMPEIRA", "BRSMG RUBELITA")

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_Log_log_inv_NE_4<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_Log_log_inv_NE_4)
```

Tmin_Media (p = 0.797853)

```{r}
fit.model<-modelo_glm_Log_log_inv_NE_4
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmin_Media)
modelo_glm_Log_log_inv_NE_5<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_Log_log_inv_NE_5)
```

UR_fld_m (p = 0.728125)

```{r}
fit.model<-modelo_glm_Log_log_inv_NE_5
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-UR_fld_m)
modelo_glm_Log_log_inv_NE_6<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_Log_log_inv_NE_6)
```
Chuva_ACC (p = 0.455568)

```{r}
fit.model<-modelo_glm_Log_log_inv_NE_6
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Chuva_ACC)
modelo_glm_Log_log_inv_NE_7<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_Log_log_inv_NE_7)
```

Tmax_ACC_R (p = 0.434360)

```{r}
fit.model<-modelo_glm_Log_log_inv_NE_7
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmax_ACC_R)
modelo_glm_Log_log_inv_NE_8<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_Log_log_inv_NE_8)
```

Tmax_fld_m (p = 0.471232)

```{r}
fit.model<-modelo_glm_Log_log_inv_NE_8
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmax_fld_m)
modelo_glm_Log_log_inv_NE_9<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_Log_log_inv_NE_9)
```

Tmax_Minima (p = 0.450949)

```{r}
fit.model<-modelo_glm_Log_log_inv_NE_9
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmax_Minima)
modelo_glm_Log_log_inv_NE_10<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_Log_log_inv_NE_10)
```

longitude (p = 0.268670)

```{r}
fit.model<-modelo_glm_Log_log_inv_NE_10
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-longitude)
modelo_glm_Log_log_inv_NE_11<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_Log_log_inv_NE_11)
```

Rad_ACC_R (p = 0.232878)

```{r}
fit.model<-modelo_glm_Log_log_inv_NE_11
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Rad_ACC_R)
modelo_glm_Log_log_inv_NE_12<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_Log_log_inv_NE_12)
```

Tmax_Maxima (p = 0.180129)

```{r}
fit.model<-modelo_glm_Log_log_inv_NE_12
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmax_Maxima)
modelo_glm_Log_log_inv_NE_13<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_Log_log_inv_NE_13)
```

Rad_ACC (p = 0.203748)

```{r}
fit.model<-modelo_glm_Log_log_inv_NE_13
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Rad_ACC)
modelo_glm_Log_log_inv_NE_14<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_Log_log_inv_NE_14)
```

Tmin_fld_m (p = 0.117615)

```{r}
fit.model<-modelo_glm_Log_log_inv_NE_14
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmin_fld_m)
modelo_glm_Log_log_inv_NE_15<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_Log_log_inv_NE_15)
```

latitude  (p = 0.092939)

```{r}
fit.model<-modelo_glm_Log_log_inv_NE_15
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-latitude)
modelo_glm_Log_log_inv_NE_16<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_Log_log_inv_NE_16)
```

Graus_dia_ciclo (p = 0.069399)

```{r}
fit.model<-modelo_glm_Log_log_inv_NE_16
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Graus_dia_ciclo)
modelo_glm_Log_log_inv_NE_17<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "inverse" ))
summary(modelo_glm_Log_log_inv_NE_17)
```

```{r}
Temporario_glm_Log_log_inv_NE_17 <- Temporario
```


#### Analise de residos.

```{r}
#------------------------------------------------------------#
# Para rodar este programa deixe no objeto fit.model a saída      
# do ajuste da regressão com erros gama e ligação log.  Deixe     
# também os dados disponíveis através do comando attach(...).    
# Depois use o comando source(...) no R ou S-Plus para        
# executar o programa. A sequência de comandos é a seguinte:               
#
       fit.model <- modelo_glm_Log_log_inv_NE_17
       attach(Temporario_glm_Log_log_inv_NE_17)
       source("envel_gama.txt")                                      
#
# A saída será o gráfico de envelope para o resíduo componente 
# do desvio padronizado. Para colocar um título no gráfico use
# o comando title("..."). Para  usar  outras  ligações mudar 
# no programa abaixo o termo family=Gamma(link=log) para 
# family=Gamma no caso de ligação  recíproca ou por 
# family= Gamma(link=identity) no caso de ligação identidade.
#------------------------------------------------------------#
par(mfrow=c(1,1))
X <- model.matrix(fit.model)
n <- nrow(X)
p <- ncol(X)
w <- fit.model$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit.model,type="response")
fi <- (n-p)/sum((ro/(fitted(fit.model)))^ 2)
td <- resid(fit.model,type="deviance")*sqrt(fi/(1-h))
#
e <- matrix(0,n,100)
#
for(i in 1:100){
resp <- rgamma(n,fi)
resp <- (fitted(fit.model)/fi)*resp
fit <- glm(resp ~ X, family=Gamma(link=log))
w <- fit$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit,type="response")
phi <- (n-p)/sum((ro/(fitted(fit)))^ 2)
e[,i] <- sort(resid(fit,type="deviance")*sqrt(phi/(1-h)))}
#
e1 <- numeric(n)
e2 <- numeric(n)
#
for(i in 1:n){
  eo <- sort(e[i,])
e1[i] <- (eo[2]+eo[3])/2
e2[i] <- (eo[97]+eo[98])/2}
#
med <- apply(e,1,mean)
faixa <- range(td,e1,e2)
par(pty="s")
qqnorm(td, xlab="Percentil da N(0,1)",
ylab="Componente do Desvio", ylim=faixa, pch=16, main="")
par(new=TRUE)
#
qqnorm(e1,axes=F,xlab="",ylab="",type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(e2,axes=F,xlab="",ylab="", type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(med,axes=F,xlab="", ylab="", type="l",ylim=faixa,lty=2, main="")

#------------------------------------------------------------#          
```

```{r}
#------------------------------------------------------------#
# Para rodar este programa  deixe no objeto fit.model a saída 
# do  ajuste  da  regressão com  erros gama.   Deixe  os dados 
# disponíveis  através do comando attach(...). Depois  use  o 
# comando source(...) no S-Plus ou R para executar o programa. 
# A sequência de comandos é a seguinte:
#
         fit.model <- modelo_glm_Log_log_inv_NE_17
         attach(Temporario_glm_Log_log_inv_NE_17)
         source("diag_gama.txt")
#
# A saída terá quatro gráficos: de pontos de alacanca, 
# de pontos influentes  e  dois de resíduos. Para 
# identificar os pontos que  mais  se destacam usar o 
# comando identify(...). Se por exemplo se destacam
# três pontos no plot(fitted(fit.model),h,...), 
# após esse comando coloque
#     
#        > identify(fitted(fit.model),h,n=3)
#
# O mesmo pode ser feito nos demais gráficos. Nos gráficos de 
# resíduos foram colocados os limites ylim=c(a-1,b+1), 
# em que a é o menor valor e b o maior valor para o resíduo. 
# Este programa usa a library MASS para estimar o parâmetro
# fi da gama que  estará guardado no objeto fi.
#------------------------------------------------------------#
X <- model.matrix(fit.model)
n <- nrow(X)
p <- ncol(X)
w <- fit.model$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
library(MASS)
fi <- gamma.shape(fit.model)$alpha
ts <- resid(fit.model,type="pearson")*sqrt(fi/(1-h))
td <- resid(fit.model,type="deviance")*sqrt(fi/(1-h))
di <- (h/(1-h))*(ts^2)
par(mfrow=c(2,2))
a <- max(td)
b <- min(td)
plot(fitted(fit.model),h,xlab="Valor Ajustado", ylab="Medida h", pch=16)
#identify(fitted(fit.model), h, n=1)
#
plot(di,xlab="Índice", ylab="Distância de Cook", pch=16)
#identify(di, n=2)
#
plot(fitted(fit.model),td,xlab="Valor Ajustado", ylab="Resíduo Componente do Desvio",
ylim=c(b-1,a+1),pch=16)
abline(2,0,lty=2)
abline(-2,0,lty=2)
#identify(fitted(fit.model),td, n=1)
#
w <- fit.model$weights
eta <- predict(fit.model)
z <- eta + resid(fit.model, type="pearson")/sqrt(w)
plot(predict(fit.model),z,xlab="Preditor Linear", 
ylab="Variável z", pch=16)
par(mfrow=c(1,1))
#------------------------------------------------------------#

```


```{r}
 detach("package:MASS", unload = TRUE)
```

### Removendo linhas
```{r}
teste<-td
teste1 <- sort(teste)
match(teste1[1:3], teste)
```
```{r}
Temporario<- Temporario_glm_Log_log_inv_NE_17[c(-177 ,-175 ,-392),]
modelo_glm_Log_log_inv_NE_18<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_Log_log_inv_NE_18)
```

```{r}
#------------------------------------------------------------#
# Para rodar este programa deixe no objeto fit.model a saída      
# do ajuste da regressão com erros gama e ligação log.  Deixe     
# também os dados disponíveis através do comando attach(...).    
# Depois use o comando source(...) no R ou S-Plus para        
# executar o programa. A sequência de comandos é a seguinte:               
#
       fit.model <- modelo_glm_Log_log_inv_NE_18
       attach(Temporario)
       source("envel_gama.txt")                                      
#
# A saída será o gráfico de envelope para o resíduo componente 
# do desvio padronizado. Para colocar um título no gráfico use
# o comando title("..."). Para  usar  outras  ligações mudar 
# no programa abaixo o termo family=Gamma(link=log) para 
# family=Gamma no caso de ligação  recíproca ou por 
# family= Gamma(link=identity) no caso de ligação identidade.
#------------------------------------------------------------#
par(mfrow=c(1,1))
X <- model.matrix(fit.model)
n <- nrow(X)
p <- ncol(X)
w <- fit.model$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit.model,type="response")
fi <- (n-p)/sum((ro/(fitted(fit.model)))^ 2)
td <- resid(fit.model,type="deviance")*sqrt(fi/(1-h))
#
e <- matrix(0,n,100)
#
for(i in 1:100){
resp <- rgamma(n,fi)
resp <- (fitted(fit.model)/fi)*resp
fit <- glm(resp ~ X, family=Gamma(link=log))
w <- fit$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit,type="response")
phi <- (n-p)/sum((ro/(fitted(fit)))^ 2)
e[,i] <- sort(resid(fit,type="deviance")*sqrt(phi/(1-h)))}
#
e1 <- numeric(n)
e2 <- numeric(n)
#
for(i in 1:n){
  eo <- sort(e[i,])
e1[i] <- (eo[2]+eo[3])/2
e2[i] <- (eo[97]+eo[98])/2}
#
med <- apply(e,1,mean)
faixa <- range(td,e1,e2)
par(pty="s")
qqnorm(td, xlab="Percentil da N(0,1)",
ylab="Componente do Desvio", ylim=faixa, pch=16, main="")
par(new=TRUE)
#
qqnorm(e1,axes=F,xlab="",ylab="",type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(e2,axes=F,xlab="",ylab="", type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(med,axes=F,xlab="", ylab="", type="l",ylim=faixa,lty=2, main="")

#------------------------------------------------------------#          
```






#3) LINK 1/mu^2 

```{r}
 detach("package:MASS", unload = TRUE)
```

```{r}
Temporario<-Nordeste[,c(-1,-3)]
modelo_glm_mu_NE_<- glm(FLO_M~.,Temporario,   family = Gamma(link = "1/mu^2"))
summary(modelo_glm_mu_NE_)
```

```{r}
fit.model<-modelo_glm_mu_NE_
m.C <- rbind(cbind(	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	)
)
testeF.CB(fit.model,m.C)
```

```{r}
Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("ALIANCA","BRS A704",	"BRS FORMOSO",	"BRS GUARA",	"BRS JABURU",	"CICA 8",	"EMPASC 101",	"EPAGRI 108",	"EPAGRI 109",	"MOXOTO",	"PR268",	"SCS 114 ANDOSAN",	"SCS 116 SATORU",	"SCS 121 CL")

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_mu_NE_1<- glm(FLO_M~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_mu_NE_1)
```

```{r}
fit.model<-modelo_glm_mu_NE_1
m.C <- rbind(cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	)
)
testeF.CB(fit.model,m.C)
```

```{r}
Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("BRS CATIANA",    "IAC1298" ,   "IAC1299" ,   "OUROMINAS" ,    "PR267",      "SCSBRS 113 TIO TAKA")

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_mu_NE_2<- glm(FLO_M~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_mu_NE_2)
```


```{r}
fit.model<-modelo_glm_mu_NE_2
m.C <- rbind(cbind(	0,	0,	0,	0,	0,	0,	0,	1,	0,		0,	0,	0,	0,	0,	0,	0,	0,	0,	0,			0,	0,	0,	0,	0,	0,	0,	0,	0,	0,			0,	0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	1,	0,	0,	0,	0,			0,	0,	0,	0,	0,	0,	0,	0,	0,	0,			0,	0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	)
)
testeF.CB(fit.model,m.C)
```

```{r}
Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("BRS ALVORADA",    "BRSMG RUBELITA")

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_mu_NE_3<- glm(FLO_M~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_mu_NE_3)
```




```{r}
fit.model<-modelo_glm_mu_NE_3
m.C <- rbind(cbind(	0,	0,	0,	0,	0,	0,	0,		0,		0,	0,	0,	1,	0,		0,	0,	0,	0,			0,	0,	0,	0,	0,	0,	0,	0,	0,	0,			0,	0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	),
cbind(	0,	0,	0,	0,	0,	0,	0,		0,		0,	0,	0,	0,	0,		0,	0,	0,	0,			1,	0,	0,	0,	0,	0,	0,	0,	0,	0,			0,	0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0	)
)
testeF.CB(fit.model,m.C)
```

```{r}
Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("BRS PAMPEIRA",  "IAC1307" )

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_mu_NE_4<- glm(FLO_M~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_mu_NE_4)
```

```{r}
fit.model<-modelo_glm_mu_NE_4
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,		0,		0,	0,	0,		0,		0,	0,	0,	0,				0,	0,	0,	0,	0,	0,	0,	0,	0,			0,	0,	0,	0,	1,	0,		0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0)
testeF.CB(fit.model,m.C)
```

```{r}
Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("SCS 112" )

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_mu_NE_5<- glm(FLO_M~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_mu_NE_5)
```

Chuva_ACC (p = 0.806411)

```{r}
fit.model<-modelo_glm_mu_NE_5
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Chuva_ACC)
modelo_glm_mu_NE_6<- glm(FLO_M~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_mu_NE_6)
```
Tmin_Media (p = 0.772500) 

```{r}
fit.model<-modelo_glm_mu_NE_6
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0
)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmin_Media)
modelo_glm_mu_NE_7<- glm(FLO_M~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_mu_NE_7)
```
Tmax_fld_m  (p = 0.536596) 

```{r}
fit.model<-modelo_glm_mu_NE_7
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmax_fld_m)
modelo_glm_mu_NE_8<- glm(FLO_M~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_mu_NE_8)
```

Tmax_ACC_R (p = 0.325995) 

```{r}
fit.model<-modelo_glm_mu_NE_8
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	1,	0,	0,	0,	0,	0,	0,		0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0
)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmax_ACC_R)
modelo_glm_mu_NE_9<- glm(FLO_M~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_mu_NE_9)
```

longitude (p = 0.265240) 

```{r}
fit.model<-modelo_glm_mu_NE_9
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,		0,		0,	0,	0,	0,	0,	0,		0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0
)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-longitude)
modelo_glm_mu_NE_10<- glm(FLO_M~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_mu_NE_10)
```

Tmax_Minima (p = 0.167374) 

```{r}
fit.model<-modelo_glm_mu_NE_10
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,		0,		1,	0,	0,	0,	0,	0,		0,	0,	0,	0,	0,		0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0
)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmax_Minima)
modelo_glm_mu_NE_11<- glm(FLO_M~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_mu_NE_11)
```

Rad_ACC_R (p = 0.155983) 

```{r}
fit.model<-modelo_glm_mu_NE_11
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,		0,			0,	0,	0,	0,	0,		0,	0,	0,	0,	0,		0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0
)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Rad_ACC_R)
modelo_glm_mu_NE_12<- glm(FLO_M~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_mu_NE_12)
```

UR_fld_m (p = 0.186205) 

```{r}
fit.model<-modelo_glm_mu_NE_12
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,		0,			0,	0,	0,	0,	0,		0,	0,	0,	0,	0,		0,	0,		0,	0,	0,	0,	1,	0,	0,	0)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-UR_fld_m)
modelo_glm_mu_NE_13<- glm(FLO_M~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_mu_NE_13)
```

Tmin_R (p = 0.061013) 

```{r}
fit.model<-modelo_glm_mu_NE_13
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,		0,	0,		0,			0,	0,	0,	0,	0,		0,	0,	0,	1,	0,		0,	0,		0,	0,	0,	0,		0,	0,	0
)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmin_R)
modelo_glm_mu_NE_14<- glm(FLO_M~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_mu_NE_14)
```

```{r}
Temporario_glm_mu_NE_14 <- Temporario
```


## Analise de residos.

```{r}
#------------------------------------------------------------#
# Para rodar este programa  deixe no objeto fit.model a saída 
# do  ajuste  da  regressão com  erros gama.   Deixe  os dados 
# disponíveis  através do comando attach(...). Depois  use  o 
# comando source(...) no S-Plus ou R para executar o programa. 
# A sequência de comandos é a seguinte:
#
         fit.model <- modelo_glm_mu_NE_14
         attach(Temporario_glm_mu_NE_14)
         source("diag_gama.txt")
#
# A saída terá quatro gráficos: de pontos de alacanca, 
# de pontos influentes  e  dois de resíduos. Para 
# identificar os pontos que  mais  se destacam usar o 
# comando identify(...). Se por exemplo se destacam
# três pontos no plot(fitted(fit.model),h,...), 
# após esse comando coloque
#     
#        > identify(fitted(fit.model),h,n=3)
#
# O mesmo pode ser feito nos demais gráficos. Nos gráficos de 
# resíduos foram colocados os limites ylim=c(a-1,b+1), 
# em que a é o menor valor e b o maior valor para o resíduo. 
# Este programa usa a library MASS para estimar o parâmetro
# fi da gama que  estará guardado no objeto fi.
#------------------------------------------------------------#
X <- model.matrix(fit.model)
n <- nrow(X)
p <- ncol(X)
w <- fit.model$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
library(MASS)
fi <- gamma.shape(fit.model)$alpha
ts <- resid(fit.model,type="pearson")*sqrt(fi/(1-h))
td <- resid(fit.model,type="deviance")*sqrt(fi/(1-h))
di <- (h/(1-h))*(ts^2)
par(mfrow=c(2,2))
a <- max(td)
b <- min(td)
plot(fitted(fit.model),h,xlab="Valor Ajustado", ylab="Medida h", pch=16)
#identify(fitted(fit.model), h, n=1)
#
plot(di,xlab="Índice", ylab="Distância de Cook", pch=16)
#identify(di, n=2)
#
plot(fitted(fit.model),td,xlab="Valor Ajustado", ylab="Resíduo Componente do Desvio",
ylim=c(b-1,a+1),pch=16)
abline(2,0,lty=2)
abline(-2,0,lty=2)
#identify(fitted(fit.model),td, n=1)
#
w <- fit.model$weights
eta <- predict(fit.model)
z <- eta + resid(fit.model, type="pearson")/sqrt(w)
plot(predict(fit.model),z,xlab="Preditor Linear", 
ylab="Variável z", pch=16)
par(mfrow=c(1,1))
#------------------------------------------------------------#

```

```{r}
#------------------------------------------------------------#
# Para rodar este programa deixe no objeto fit.model a saída      
# do ajuste da regressão com erros gama e ligação log.  Deixe     
# também os dados disponíveis através do comando attach(...).    
# Depois use o comando source(...) no R ou S-Plus para        
# executar o programa. A sequência de comandos é a seguinte:               
#
       fit.model <- modelo_glm_mu_NE_14
       attach(Temporario_glm_mu_NE_14)
       source("envel_gama.txt")                                      
#
# A saída será o gráfico de envelope para o resíduo componente 
# do desvio padronizado. Para colocar um título no gráfico use
# o comando title("..."). Para  usar  outras  ligações mudar 
# no programa abaixo o termo family=Gamma(link=log) para 
# family=Gamma no caso de ligação  recíproca ou por 
# family= Gamma(link=identity) no caso de ligação identidade.
#------------------------------------------------------------#
par(mfrow=c(1,1))
X <- model.matrix(fit.model)
n <- nrow(X)
p <- ncol(X)
w <- fit.model$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit.model,type="response")
fi <- (n-p)/sum((ro/(fitted(fit.model)))^ 2)
td <- resid(fit.model,type="deviance")*sqrt(fi/(1-h))
#
e <- matrix(0,n,100)
#
for(i in 1:100){
resp <- rgamma(n,fi)
resp <- (fitted(fit.model)/fi)*resp
fit <- glm(resp ~ X, family=Gamma(link=log))
w <- fit$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit,type="response")
phi <- (n-p)/sum((ro/(fitted(fit)))^ 2)
e[,i] <- sort(resid(fit,type="deviance")*sqrt(phi/(1-h)))}
#
e1 <- numeric(n)
e2 <- numeric(n)
#
for(i in 1:n){
  eo <- sort(e[i,])
e1[i] <- (eo[2]+eo[3])/2
e2[i] <- (eo[97]+eo[98])/2}
#
med <- apply(e,1,mean)
faixa <- range(td,e1,e2)
par(pty="s")
qqnorm(td, xlab="Percentil da N(0,1)",
ylab="Componente do Desvio", ylim=faixa, pch=16, main="")
par(new=TRUE)
#
qqnorm(e1,axes=F,xlab="",ylab="",type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(e2,axes=F,xlab="",ylab="", type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(med,axes=F,xlab="", ylab="", type="l",ylim=faixa,lty=2, main="")

#------------------------------------------------------------#          
```

```{r}
 detach("package:MASS", unload = TRUE)
```

## Removendo linhas
```{r}
teste<-td
teste1 <- sort(teste)
match(teste1[1:3], teste)
```
```{r}
Temporario<- Temporario_glm_mu_NE_14[c(-177 ,-175 ,-392),]
modelo_glm_mu_NE_15<- glm(FLO_M~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_mu_NE_15)
```

```{r}
#------------------------------------------------------------#
# Para rodar este programa deixe no objeto fit.model a saída      
# do ajuste da regressão com erros gama e ligação log.  Deixe     
# também os dados disponíveis através do comando attach(...).    
# Depois use o comando source(...) no R ou S-Plus para        
# executar o programa. A sequência de comandos é a seguinte:               
#
       fit.model <- modelo_glm_mu_NE_15
       attach(Temporario)
       source("envel_gama.txt")                                      
#
# A saída será o gráfico de envelope para o resíduo componente 
# do desvio padronizado. Para colocar um título no gráfico use
# o comando title("..."). Para  usar  outras  ligações mudar 
# no programa abaixo o termo family=Gamma(link=log) para 
# family=Gamma no caso de ligação  recíproca ou por 
# family= Gamma(link=identity) no caso de ligação identidade.
#------------------------------------------------------------#
par(mfrow=c(1,1))
X <- model.matrix(fit.model)
n <- nrow(X)
p <- ncol(X)
w <- fit.model$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit.model,type="response")
fi <- (n-p)/sum((ro/(fitted(fit.model)))^ 2)
td <- resid(fit.model,type="deviance")*sqrt(fi/(1-h))
#
e <- matrix(0,n,100)
#
for(i in 1:100){
resp <- rgamma(n,fi)
resp <- (fitted(fit.model)/fi)*resp
fit <- glm(resp ~ X, family=Gamma(link=log))
w <- fit$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit,type="response")
phi <- (n-p)/sum((ro/(fitted(fit)))^ 2)
e[,i] <- sort(resid(fit,type="deviance")*sqrt(phi/(1-h)))}
#
e1 <- numeric(n)
e2 <- numeric(n)
#
for(i in 1:n){
  eo <- sort(e[i,])
e1[i] <- (eo[2]+eo[3])/2
e2[i] <- (eo[97]+eo[98])/2}
#
med <- apply(e,1,mean)
faixa <- range(td,e1,e2)
par(pty="s")
qqnorm(td, xlab="Percentil da N(0,1)",
ylab="Componente do Desvio", ylim=faixa, pch=16, main="")
par(new=TRUE)
#
qqnorm(e1,axes=F,xlab="",ylab="",type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(e2,axes=F,xlab="",ylab="", type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(med,axes=F,xlab="", ylab="", type="l",ylim=faixa,lty=2, main="")

#------------------------------------------------------------#          
```

```{r}
#Normalidade dos residuos
jarque.bera.test(td) #Residuo Studentizado # p > 0,05 = normal

```



### Removendo mais linhas

```{r}
teste<-td
teste1 <- sort(teste)
match(teste1[2:10], teste)
```

```{r}
Temporario1<- Temporario[c( -222, -289, -373, -213, -432,  -25, -393),]
modelo_glm_mu_NE_16<- glm(FLO_M~.,Temporario1, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_mu_NE_16)
```
```{r}
fit.model<-modelo_glm_mu_NE_16
m.C <- cbind(0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0
)
testeF.CB(fit.model,m.C)
```

```{r}
Genotipos  <- Temporario1$GENOTIPO
SELECAO_GEN <- c("BRS A701 CL")

Temporario1$GENOTIPO <- c(ifelse(Temporario1$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_mu_NE_17<- glm(FLO_M~.,Temporario1, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_mu_NE_17)
```
Tmin_fld_m (p = 0.056808)

```{r}
fit.model<-modelo_glm_mu_NE_17
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0
)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario1<-Temporario1 %>% select(-Tmin_fld_m)
modelo_glm_mu_NE_18<- glm(FLO_M~.,Temporario1, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_mu_NE_18)
```
Tmin_Maxima (p = 0.104800) 

```{r}
fit.model<-modelo_glm_mu_NE_18
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0

)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario1<-Temporario1 %>% select(-Tmin_Maxima)
modelo_glm_mu_NE_19<- glm(FLO_M~.,Temporario1, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_mu_NE_19)
```
Tmax_Maxima (p = 0.081099)

```{r}
fit.model<-modelo_glm_mu_NE_19
m.C <- cbind(
0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario1<-Temporario1 %>% select(-Tmax_Maxima)
modelo_glm_mu_NE_20<- glm(FLO_M~.,Temporario1, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_mu_NE_20)
```
UR_V (p = 0.059305)

```{r}
fit.model<-modelo_glm_mu_NE_20
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0
)
testeF.CB(fit.model,m.C)
```
```{r}
Temporario1<-Temporario1 %>% select(-UR_V)
modelo_glm_mu_NE_21<- glm(FLO_M~.,Temporario1, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_mu_NE_21)
```



```{r}
#------------------------------------------------------------#
# Para rodar este programa deixe no objeto fit.model a saída      
# do ajuste da regressão com erros gama e ligação log.  Deixe     
# também os dados disponíveis através do comando attach(...).    
# Depois use o comando source(...) no R ou S-Plus para        
# executar o programa. A sequência de comandos é a seguinte:               
#
       fit.model <- modelo_glm_mu_NE_21
       attach(Temporario1)
      source("envel_gama.txt")                                      
#
# A saída será o gráfico de envelope para o resíduo componente 
# do desvio padronizado. Para colocar um título no gráfico use
# o comando title("..."). Para  usar  outras  ligações mudar 
# no programa abaixo o termo family=Gamma(link=log) para 
# family=Gamma no caso de ligação  recíproca ou por 
# family= Gamma(link=identity) no caso de ligação identidade.
#------------------------------------------------------------#
par(mfrow=c(1,1))
X <- model.matrix(fit.model)
n <- nrow(X)
p <- ncol(X)
w <- fit.model$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit.model,type="response")
fi <- (n-p)/sum((ro/(fitted(fit.model)))^ 2)
td <- resid(fit.model,type="deviance")*sqrt(fi/(1-h))
#
e <- matrix(0,n,100)
#
for(i in 1:100){
resp <- rgamma(n,fi)
resp <- (fitted(fit.model)/fi)*resp
fit <- glm(resp ~ X, family=Gamma(link=log))
w <- fit$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit,type="response")
phi <- (n-p)/sum((ro/(fitted(fit)))^ 2)
e[,i] <- sort(resid(fit,type="deviance")*sqrt(phi/(1-h)))}
#
e1 <- numeric(n)
e2 <- numeric(n)
#
for(i in 1:n){
  eo <- sort(e[i,])
e1[i] <- (eo[2]+eo[3])/2
e2[i] <- (eo[97]+eo[98])/2}
#
med <- apply(e,1,mean)
faixa <- range(td,e1,e2)
par(pty="s")
qqnorm(td, xlab="Percentil da N(0,1)",
ylab="Componente do Desvio", ylim=faixa, pch=16, main="")
par(new=TRUE)
#
qqnorm(e1,axes=F,xlab="",ylab="",type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(e2,axes=F,xlab="",ylab="", type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(med,axes=F,xlab="", ylab="", type="l",ylim=faixa,lty=2, main="")

#------------------------------------------------------------#          
```



### mais 3 linhas

```{r}
teste<-td
teste1 <- sort(teste)
match(teste1[2:3], teste)
```

```{r}
Temporario<- Temporario1[c( -166, -256, -159),]
modelo_glm_mu_NE_22<- glm(FLO_M~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_mu_NE_22)
```
```{r}
#------------------------------------------------------------#
# Para rodar este programa deixe no objeto fit.model a saída      
# do ajuste da regressão com erros gama e ligação log.  Deixe     
# também os dados disponíveis através do comando attach(...).    
# Depois use o comando source(...) no R ou S-Plus para        
# executar o programa. A sequência de comandos é a seguinte:               
#
       fit.model <- modelo_glm_mu_NE_22
       attach(Temporario)
      source("envel_gama.txt")                                      
#
# A saída será o gráfico de envelope para o resíduo componente 
# do desvio padronizado. Para colocar um título no gráfico use
# o comando title("..."). Para  usar  outras  ligações mudar 
# no programa abaixo o termo family=Gamma(link=log) para 
# family=Gamma no caso de ligação  recíproca ou por 
# family= Gamma(link=identity) no caso de ligação identidade.
#------------------------------------------------------------#
par(mfrow=c(1,1))
X <- model.matrix(fit.model)
n <- nrow(X)
p <- ncol(X)
w <- fit.model$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit.model,type="response")
fi <- (n-p)/sum((ro/(fitted(fit.model)))^ 2)
td <- resid(fit.model,type="deviance")*sqrt(fi/(1-h))
#
e <- matrix(0,n,100)
#
for(i in 1:100){
resp <- rgamma(n,fi)
resp <- (fitted(fit.model)/fi)*resp
fit <- glm(resp ~ X, family=Gamma(link=log))
w <- fit$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit,type="response")
phi <- (n-p)/sum((ro/(fitted(fit)))^ 2)
e[,i] <- sort(resid(fit,type="deviance")*sqrt(phi/(1-h)))}
#
e1 <- numeric(n)
e2 <- numeric(n)
#
for(i in 1:n){
  eo <- sort(e[i,])
e1[i] <- (eo[2]+eo[3])/2
e2[i] <- (eo[97]+eo[98])/2}
#
med <- apply(e,1,mean)
faixa <- range(td,e1,e2)
par(pty="s")
qqnorm(td, xlab="Percentil da N(0,1)",
ylab="Componente do Desvio", ylim=faixa, pch=16, main="")
par(new=TRUE)
#
qqnorm(e1,axes=F,xlab="",ylab="",type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(e2,axes=F,xlab="",ylab="", type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(med,axes=F,xlab="", ylab="", type="l",ylim=faixa,lty=2, main="")

#------------------------------------------------------------#          
```

```{r}
#Normalidade dos residuos
jarque.bera.test(td) #Residuo Studentizado # p > 0,05 = normal

```



### mais 2 pontos 

```{r}
teste<-td
teste1 <- sort(teste)
match(teste1[1], teste)
```

```{r}
Temporario1<- Temporario[c( -163,-181 ),]
modelo_glm_mu_NE_23<- glm(FLO_M~.,Temporario1, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_mu_NE_23)
```
```{r}
fit.model<-modelo_glm_mu_NE_23
m.C <- cbind(0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0
)
testeF.CB(fit.model,m.C)
```

```{r}
Genotipos  <- Temporario1$GENOTIPO
SELECAO_GEN <- c("BRS FRONTEIRA")

Temporario1$GENOTIPO <- c(ifelse(Temporario1$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_mu_NE_23<- glm(FLO_M~.,Temporario1, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_mu_NE_23)
```






```{r}
#------------------------------------------------------------#
# Para rodar este programa deixe no objeto fit.model a saída      
# do ajuste da regressão com erros gama e ligação log.  Deixe     
# também os dados disponíveis através do comando attach(...).    
# Depois use o comando source(...) no R ou S-Plus para        
# executar o programa. A sequência de comandos é a seguinte:               
#
       fit.model <- modelo_glm_mu_NE_23
       attach(Temporario1)
      source("envel_gama.txt")                                      
#
# A saída será o gráfico de envelope para o resíduo componente 
# do desvio padronizado. Para colocar um título no gráfico use
# o comando title("..."). Para  usar  outras  ligações mudar 
# no programa abaixo o termo family=Gamma(link=log) para 
# family=Gamma no caso de ligação  recíproca ou por 
# family= Gamma(link=identity) no caso de ligação identidade.
#------------------------------------------------------------#
par(mfrow=c(1,1))
X <- model.matrix(fit.model)
n <- nrow(X)
p <- ncol(X)
w <- fit.model$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit.model,type="response")
fi <- (n-p)/sum((ro/(fitted(fit.model)))^ 2)
td <- resid(fit.model,type="deviance")*sqrt(fi/(1-h))
#
e <- matrix(0,n,100)
#
for(i in 1:100){
resp <- rgamma(n,fi)
resp <- (fitted(fit.model)/fi)*resp
fit <- glm(resp ~ X, family=Gamma(link=log))
w <- fit$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit,type="response")
phi <- (n-p)/sum((ro/(fitted(fit)))^ 2)
e[,i] <- sort(resid(fit,type="deviance")*sqrt(phi/(1-h)))}
#
e1 <- numeric(n)
e2 <- numeric(n)
#
for(i in 1:n){
  eo <- sort(e[i,])
e1[i] <- (eo[2]+eo[3])/2
e2[i] <- (eo[97]+eo[98])/2}
#
med <- apply(e,1,mean)
faixa <- range(td,e1,e2)
par(pty="s")
qqnorm(td, xlab="Percentil da N(0,1)",
ylab="Componente do Desvio", ylim=faixa, pch=16, main="")
par(new=TRUE)
#
qqnorm(e1,axes=F,xlab="",ylab="",type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(e2,axes=F,xlab="",ylab="", type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(med,axes=F,xlab="", ylab="", type="l",ylim=faixa,lty=2, main="")

#------------------------------------------------------------#          
```
```{r}
#Normalidade dos residuos
jarque.bera.test(td) #Residuo Studentizado # p > 0,05 = normal

```

Homocedasticidade
```{r}
library(lmtest)
bptest(modelo_glm_mu_NE_23)
```


```{r}
df_Modelo_GLM_Nordeste <- Temporario1
Modelo_GLM_Nordeste <- modelo_glm_mu_NE_23
```



## Transf. log



```{r}
Temporario<-Nordeste[,c(-1,-3)]
modelo_glm_log_mu_NE_<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "1/mu^2"))
summary(modelo_glm_log_mu_NE_)
```

```{r}
fit.model<-modelo_glm_log_mu_NE_
m.C <- cbind()
testeF.CB(fit.model,m.C)
```

```{r}
Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("ALIANCA","BRS A704","BRS JABURU","CICA 8","EMPASC 101","EPAGRI 108","EPAGRI 109", "MOXOTO","PR268", "SCS 114 ANDOSAN")

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_log_mu_NE_1<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_log_mu_NE_1)
```
```{r}
fit.model<-modelo_glm_log_mu_NE_1
m.C <- cbind()
testeF.CB(fit.model,m.C)
```

```{r}
Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("BRS FORMOSO","BRS GUARA","IAC1298", "PR267","SCS 116 SATORU","SCS 121 CL", "SCSBRS 113 TIO TAKA")

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_log_mu_NE_2<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_log_mu_NE_2)
```
```{r}
fit.model<-modelo_glm_log_mu_NE_2
m.C <- cbind()
testeF.CB(fit.model,m.C)
```

```{r}
Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("BRS ALVORADA","BRS CATIANA","IAC1299","OUROMINAS")

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_log_mu_NE_3<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_log_mu_NE_3)
```
```{r}
fit.model<-modelo_glm_log_mu_NE_3
m.C <- cbind()
testeF.CB(fit.model,m.C)
```

```{r}
Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("BRS PAMPEIRA", "BRSMG RUBELITA", "IAC1307")

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_log_mu_NE_4<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_log_mu_NE_4)
```
Tmin_Media (p = 0.861604) 

```{r}
fit.model<-modelo_glm_log_mu_NE_4
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmin_Media)
modelo_glm_log_mu_NE_5<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_log_mu_NE_5)
```

UR_fld_m (p = 0.817269) 

```{r}
fit.model<-modelo_glm_log_mu_NE_5
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-UR_fld_m)
modelo_glm_log_mu_NE_6<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_log_mu_NE_6)
```

Chuva_ACC (p = 0.482512) 

```{r}
fit.model<-modelo_glm_log_mu_NE_6
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Chuva_ACC)
modelo_glm_log_mu_NE_7<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_log_mu_NE_7)
```

Tmax_ACC_R (p = 0.406571) 

```{r}
fit.model<-modelo_glm_log_mu_NE_7
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmax_ACC_R)
modelo_glm_log_mu_NE_8<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_log_mu_NE_8)
```

Tmax_fld_m (p = 0.398380) 

```{r}
fit.model<-modelo_glm_log_mu_NE_8
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmax_fld_m)
modelo_glm_log_mu_NE_9<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_log_mu_NE_9)
```

Tmax_Minima (p = 0.421646) 

```{r}
fit.model<-modelo_glm_log_mu_NE_9
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmax_Minima)
modelo_glm_log_mu_NE_10<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_log_mu_NE_10)
```

longitude (p = 0.301052) 

```{r}
fit.model<-modelo_glm_log_mu_NE_10
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-longitude)
modelo_glm_log_mu_NE_11<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_log_mu_NE_11)
```

Rad_ACC_R (p = 0.229686) 

```{r}
fit.model<-modelo_glm_log_mu_NE_11
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Rad_ACC_R)
modelo_glm_log_mu_NE_12<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_log_mu_NE_12)
```

Tmax_Maxima (p = 0.154403) 

```{r}
fit.model<-modelo_glm_log_mu_NE_12
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmax_Maxima)
modelo_glm_log_mu_NE_13<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_log_mu_NE_13)
```

Rad_ACC (p = 0.172801) 

```{r}
fit.model<-modelo_glm_log_mu_NE_13
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Rad_ACC)
modelo_glm_log_mu_NE_14<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_log_mu_NE_14)
```

Tmin_fld_m  (p = 0.107328) 

```{r}
fit.model<-modelo_glm_log_mu_NE_14
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmin_fld_m)
modelo_glm_log_mu_NE_15<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_log_mu_NE_15)
```

latitude  (p = 0.091745) 

```{r}
fit.model<-modelo_glm_log_mu_NE_15
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-latitude)
modelo_glm_log_mu_NE_16<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_log_mu_NE_16)
```

Graus_dia_ciclo (p = 0.052005) 

```{r}
fit.model<-modelo_glm_log_mu_NE_16
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Graus_dia_ciclo)
modelo_glm_log_mu_NE_17<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_log_mu_NE_17)
```

```{r}
Temporario_glm_log_mu_NE_17<- Temporario
```


### Analise de residos.

```{r}
#------------------------------------------------------------#
# Para rodar este programa deixe no objeto fit.model a saída      
# do ajuste da regressão com erros gama e ligação log.  Deixe     
# também os dados disponíveis através do comando attach(...).    
# Depois use o comando source(...) no R ou S-Plus para        
# executar o programa. A sequência de comandos é a seguinte:               
#
       fit.model <- modelo_glm_log_mu_NE_17
       attach(Temporario_glm_log_mu_NE_17)
       source("envel_gama.txt")                                      
#
# A saída será o gráfico de envelope para o resíduo componente 
# do desvio padronizado. Para colocar um título no gráfico use
# o comando title("..."). Para  usar  outras  ligações mudar 
# no programa abaixo o termo family=Gamma(link=log) para 
# family=Gamma no caso de ligação  recíproca ou por 
# family= Gamma(link=identity) no caso de ligação identidade.
#------------------------------------------------------------#
par(mfrow=c(1,1))
X <- model.matrix(fit.model)
n <- nrow(X)
p <- ncol(X)
w <- fit.model$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit.model,type="response")
fi <- (n-p)/sum((ro/(fitted(fit.model)))^ 2)
td <- resid(fit.model,type="deviance")*sqrt(fi/(1-h))
#
e <- matrix(0,n,100)
#
for(i in 1:100){
resp <- rgamma(n,fi)
resp <- (fitted(fit.model)/fi)*resp
fit <- glm(resp ~ X, family=Gamma(link=log))
w <- fit$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit,type="response")
phi <- (n-p)/sum((ro/(fitted(fit)))^ 2)
e[,i] <- sort(resid(fit,type="deviance")*sqrt(phi/(1-h)))}
#
e1 <- numeric(n)
e2 <- numeric(n)
#
for(i in 1:n){
  eo <- sort(e[i,])
e1[i] <- (eo[2]+eo[3])/2
e2[i] <- (eo[97]+eo[98])/2}
#
med <- apply(e,1,mean)
faixa <- range(td,e1,e2)
par(pty="s")
qqnorm(td, xlab="Percentil da N(0,1)",
ylab="Componente do Desvio", ylim=faixa, pch=16, main="")
par(new=TRUE)
#
qqnorm(e1,axes=F,xlab="",ylab="",type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(e2,axes=F,xlab="",ylab="", type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(med,axes=F,xlab="", ylab="", type="l",ylim=faixa,lty=2, main="")

#------------------------------------------------------------#          
```

```{r}
#------------------------------------------------------------#
# Para rodar este programa  deixe no objeto fit.model a saída 
# do  ajuste  da  regressão com  erros gama.   Deixe  os dados 
# disponíveis  através do comando attach(...). Depois  use  o 
# comando source(...) no S-Plus ou R para executar o programa. 
# A sequência de comandos é a seguinte:
#
         fit.model <- modelo_glm_log_mu_NE_17
         attach(Temporario_glm_log_mu_NE_17)
         source("diag_gama.txt")
#
# A saída terá quatro gráficos: de pontos de alacanca, 
# de pontos influentes  e  dois de resíduos. Para 
# identificar os pontos que  mais  se destacam usar o 
# comando identify(...). Se por exemplo se destacam
# três pontos no plot(fitted(fit.model),h,...), 
# após esse comando coloque
#     
#        > identify(fitted(fit.model),h,n=3)
#
# O mesmo pode ser feito nos demais gráficos. Nos gráficos de 
# resíduos foram colocados os limites ylim=c(a-1,b+1), 
# em que a é o menor valor e b o maior valor para o resíduo. 
# Este programa usa a library MASS para estimar o parâmetro
# fi da gama que  estará guardado no objeto fi.
#------------------------------------------------------------#
X <- model.matrix(fit.model)
n <- nrow(X)
p <- ncol(X)
w <- fit.model$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
library(MASS)
fi <- gamma.shape(fit.model)$alpha
ts <- resid(fit.model,type="pearson")*sqrt(fi/(1-h))
td <- resid(fit.model,type="deviance")*sqrt(fi/(1-h))
di <- (h/(1-h))*(ts^2)
par(mfrow=c(2,2))
a <- max(td)
b <- min(td)
plot(fitted(fit.model),h,xlab="Valor Ajustado", ylab="Medida h", pch=16)
#identify(fitted(fit.model), h, n=1)
#
plot(di,xlab="Índice", ylab="Distância de Cook", pch=16)
#identify(di, n=2)
#
plot(fitted(fit.model),td,xlab="Valor Ajustado", ylab="Resíduo Componente do Desvio",
ylim=c(b-1,a+1),pch=16)
abline(2,0,lty=2)
abline(-2,0,lty=2)
#identify(fitted(fit.model),td, n=1)
#
w <- fit.model$weights
eta <- predict(fit.model)
z <- eta + resid(fit.model, type="pearson")/sqrt(w)
plot(predict(fit.model),z,xlab="Preditor Linear", 
ylab="Variável z", pch=16)
par(mfrow=c(1,1))
#------------------------------------------------------------#

```

```{r}
 detach("package:MASS", unload = TRUE)
```

### Removendo linhas
```{r}
teste<-td
teste1 <- sort(teste)
match(teste1[1:3], teste)
```
```{r}
Temporario<- Temporario_glm_log_mu_NE_17[c(-177 ,-175 ,-392),]
Temporario_glm_log_mu_NE_18<- glm(log(FLO_M)~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(Temporario_glm_log_mu_NE_18)
```

```{r}
#------------------------------------------------------------#
# Para rodar este programa deixe no objeto fit.model a saída      
# do ajuste da regressão com erros gama e ligação log.  Deixe     
# também os dados disponíveis através do comando attach(...).    
# Depois use o comando source(...) no R ou S-Plus para        
# executar o programa. A sequência de comandos é a seguinte:               
#
       fit.model <- Temporario_glm_log_mu_NE_18
       attach(Temporario)
       source("envel_gama.txt")                                      
#
# A saída será o gráfico de envelope para o resíduo componente 
# do desvio padronizado. Para colocar um título no gráfico use
# o comando title("..."). Para  usar  outras  ligações mudar 
# no programa abaixo o termo family=Gamma(link=log) para 
# family=Gamma no caso de ligação  recíproca ou por 
# family= Gamma(link=identity) no caso de ligação identidade.
#------------------------------------------------------------#
par(mfrow=c(1,1))
X <- model.matrix(fit.model)
n <- nrow(X)
p <- ncol(X)
w <- fit.model$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit.model,type="response")
fi <- (n-p)/sum((ro/(fitted(fit.model)))^ 2)
td <- resid(fit.model,type="deviance")*sqrt(fi/(1-h))
#
e <- matrix(0,n,100)
#
for(i in 1:100){
resp <- rgamma(n,fi)
resp <- (fitted(fit.model)/fi)*resp
fit <- glm(resp ~ X, family=Gamma(link=log))
w <- fit$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit,type="response")
phi <- (n-p)/sum((ro/(fitted(fit)))^ 2)
e[,i] <- sort(resid(fit,type="deviance")*sqrt(phi/(1-h)))}
#
e1 <- numeric(n)
e2 <- numeric(n)
#
for(i in 1:n){
  eo <- sort(e[i,])
e1[i] <- (eo[2]+eo[3])/2
e2[i] <- (eo[97]+eo[98])/2}
#
med <- apply(e,1,mean)
faixa <- range(td,e1,e2)
par(pty="s")
qqnorm(td, xlab="Percentil da N(0,1)",
ylab="Componente do Desvio", ylim=faixa, pch=16, main="")
par(new=TRUE)
#
qqnorm(e1,axes=F,xlab="",ylab="",type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(e2,axes=F,xlab="",ylab="", type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(med,axes=F,xlab="", ylab="", type="l",ylim=faixa,lty=2, main="")

#------------------------------------------------------------#          
```


## Transf. log log




```{r}
Temporario<-Nordeste[,c(-1,-3)]
modelo_glm_log_log_mu_NE_<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "1/mu^2"))
summary(modelo_glm_log_log_mu_NE_)
```

```{r}
fit.model<-modelo_glm_log_log_mu_NE_
m.C <- cbind()
testeF.CB(fit.model,m.C)
```

```{r}
Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("ALIANCA","BRS A704","BRS JABURU", "CICA 8","EMPASC 101","EPAGRI 108","EPAGRI 109","MOXOTO","PR268","SCS 114 ANDOSAN")

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_log_log_mu_NE_1<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_log_log_mu_NE_1)
```
```{r}
fit.model<-modelo_glm_log_log_mu_NE_1
m.C <- cbind()
testeF.CB(fit.model,m.C)
```

```{r}
Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("BRS FORMOSO", "BRS GUARA", "IAC1298", "PR267", "SCS 116 SATORU", "SCS 121 CL", "SCSBRS 113 TIO TAKA")

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_log_log_mu_NE_2<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_log_log_mu_NE_2)
```

```{r}
fit.model<-modelo_glm_log_log_mu_NE_2
m.C <- cbind()
testeF.CB(fit.model,m.C)
```

```{r}
Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("BRS ALVORADA","BRS CATIANA", "IAC1299","OUROMINAS")

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_log_log_mu_NE_3<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_log_log_mu_NE_3)
```


```{r}
fit.model<-modelo_glm_log_log_mu_NE_3
m.C <- cbind()
testeF.CB(fit.model,m.C)
```

```{r}
Genotipos  <- Temporario$GENOTIPO
SELECAO_GEN <- c("BRS PAMPEIRA", "BRSMG RUBELITA", "IAC1307")

Temporario$GENOTIPO <- c(ifelse(Temporario$GENOTIPO %in% SELECAO_GEN, "AA" , Genotipos))
modelo_glm_log_log_mu_NE_4<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_log_log_mu_NE_4)
```
Tmin_Media (p = 0.831874)

```{r}
fit.model<-modelo_glm_log_log_mu_NE_4
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmin_Media)
modelo_glm_log_log_mu_NE_5<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_log_log_mu_NE_5)
```


UR_fld_m (p = 0.792475)

```{r}
fit.model<-modelo_glm_log_log_mu_NE_5
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-UR_fld_m)
modelo_glm_log_log_mu_NE_6<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_log_log_mu_NE_6)
```

Chuva_ACC (p = 0.476174)

```{r}
fit.model<-modelo_glm_log_log_mu_NE_6
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Chuva_ACC)
modelo_glm_log_log_mu_NE_7<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_log_log_mu_NE_7)
```

Tmax_ACC_R (p = 0.409712)

```{r}
fit.model<-modelo_glm_log_log_mu_NE_7
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmax_ACC_R)
modelo_glm_log_log_mu_NE_8<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_log_log_mu_NE_8)
```

Tmax_fld_m  (p = 0.419055)

```{r}
fit.model<-modelo_glm_log_log_mu_NE_8
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmax_fld_m)
modelo_glm_log_log_mu_NE_9<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_log_log_mu_NE_9)
```

Tmax_Minima (p = 0.431315)

```{r}
fit.model<-modelo_glm_log_log_mu_NE_9
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmax_Minima)
modelo_glm_log_log_mu_NE_10<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_log_log_mu_NE_10)
```

longitude (p = 0.306798)

```{r}
fit.model<-modelo_glm_log_log_mu_NE_10
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-longitude)
modelo_glm_log_log_mu_NE_11<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_log_log_mu_NE_11)
```

Rad_ACC_R (p = 0.222482)

```{r}
fit.model<-modelo_glm_log_log_mu_NE_11
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Rad_ACC_R)
modelo_glm_log_log_mu_NE_12<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_log_log_mu_NE_12)
```

Tmax_Maxima (p = 0.158716)

```{r}
fit.model<-modelo_glm_log_log_mu_NE_12
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmax_Maxima)
modelo_glm_log_log_mu_NE_13<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_log_log_mu_NE_13)
```

Rad_ACC (p = 0.168814)

```{r}
fit.model<-modelo_glm_log_log_mu_NE_13
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Rad_ACC)
modelo_glm_log_log_mu_NE_14<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_log_log_mu_NE_14)
```

Tmin_fld_m (p = 0.108119)

```{r}
fit.model<-modelo_glm_log_log_mu_NE_14
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Tmin_fld_m)
modelo_glm_log_log_mu_NE_15<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_log_log_mu_NE_15)
```

latitude (p = 0.091811)

```{r}
fit.model<-modelo_glm_log_log_mu_NE_15
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-latitude)
modelo_glm_log_log_mu_NE_16<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_log_log_mu_NE_16)
```

Graus_dia_ciclo (p = 0.050202)

```{r}
fit.model<-modelo_glm_log_log_mu_NE_16
m.C <- cbind()
testeF.CB(fit.model,m.C)
```
```{r}
Temporario<-Temporario %>% select(-Graus_dia_ciclo)
modelo_glm_log_log_mu_NE_17<- glm(log(log(FLO_M))~.,Temporario, family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_log_log_mu_NE_17)
```

```{r}
Temporario_glm_log_log_mu_NE_17<-Temporario
```


### Analise de residos.

```{r}
#------------------------------------------------------------#
# Para rodar este programa deixe no objeto fit.model a saída      
# do ajuste da regressão com erros gama e ligação log.  Deixe     
# também os dados disponíveis através do comando attach(...).    
# Depois use o comando source(...) no R ou S-Plus para        
# executar o programa. A sequência de comandos é a seguinte:               
#
       fit.model <- modelo_glm_log_log_mu_NE_17
       attach(Temporario_glm_log_log_mu_NE_17)
       source("envel_gama.txt")                                      
#
# A saída será o gráfico de envelope para o resíduo componente 
# do desvio padronizado. Para colocar um título no gráfico use
# o comando title("..."). Para  usar  outras  ligações mudar 
# no programa abaixo o termo family=Gamma(link=log) para 
# family=Gamma no caso de ligação  recíproca ou por 
# family= Gamma(link=identity) no caso de ligação identidade.
#------------------------------------------------------------#
par(mfrow=c(1,1))
X <- model.matrix(fit.model)
n <- nrow(X)
p <- ncol(X)
w <- fit.model$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit.model,type="response")
fi <- (n-p)/sum((ro/(fitted(fit.model)))^ 2)
td <- resid(fit.model,type="deviance")*sqrt(fi/(1-h))
#
e <- matrix(0,n,100)
#
for(i in 1:100){
resp <- rgamma(n,fi)
resp <- (fitted(fit.model)/fi)*resp
fit <- glm(resp ~ X, family=Gamma(link=log))
w <- fit$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit,type="response")
phi <- (n-p)/sum((ro/(fitted(fit)))^ 2)
e[,i] <- sort(resid(fit,type="deviance")*sqrt(phi/(1-h)))}
#
e1 <- numeric(n)
e2 <- numeric(n)
#
for(i in 1:n){
  eo <- sort(e[i,])
e1[i] <- (eo[2]+eo[3])/2
e2[i] <- (eo[97]+eo[98])/2}
#
med <- apply(e,1,mean)
faixa <- range(td,e1,e2)
par(pty="s")
qqnorm(td, xlab="Percentil da N(0,1)",
ylab="Componente do Desvio", ylim=faixa, pch=16, main="")
par(new=TRUE)
#
qqnorm(e1,axes=F,xlab="",ylab="",type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(e2,axes=F,xlab="",ylab="", type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(med,axes=F,xlab="", ylab="", type="l",ylim=faixa,lty=2, main="")

#------------------------------------------------------------#          
```

```{r}
#------------------------------------------------------------#
# Para rodar este programa  deixe no objeto fit.model a saída 
# do  ajuste  da  regressão com  erros gama.   Deixe  os dados 
# disponíveis  através do comando attach(...). Depois  use  o 
# comando source(...) no S-Plus ou R para executar o programa. 
# A sequência de comandos é a seguinte:
#
         fit.model <- modelo_glm_log_log_mu_NE_17
         attach(Temporario_glm_log_log_mu_NE_17)
         source("diag_gama.txt")
#
# A saída terá quatro gráficos: de pontos de alacanca, 
# de pontos influentes  e  dois de resíduos. Para 
# identificar os pontos que  mais  se destacam usar o 
# comando identify(...). Se por exemplo se destacam
# três pontos no plot(fitted(fit.model),h,...), 
# após esse comando coloque
#     
#        > identify(fitted(fit.model),h,n=3)
#
# O mesmo pode ser feito nos demais gráficos. Nos gráficos de 
# resíduos foram colocados os limites ylim=c(a-1,b+1), 
# em que a é o menor valor e b o maior valor para o resíduo. 
# Este programa usa a library MASS para estimar o parâmetro
# fi da gama que  estará guardado no objeto fi.
#------------------------------------------------------------#
X <- model.matrix(fit.model)
n <- nrow(X)
p <- ncol(X)
w <- fit.model$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
library(MASS)
fi <- gamma.shape(fit.model)$alpha
ts <- resid(fit.model,type="pearson")*sqrt(fi/(1-h))
td <- resid(fit.model,type="deviance")*sqrt(fi/(1-h))
di <- (h/(1-h))*(ts^2)
par(mfrow=c(2,2))
a <- max(td)
b <- min(td)
plot(fitted(fit.model),h,xlab="Valor Ajustado", ylab="Medida h", pch=16)
#identify(fitted(fit.model), h, n=1)
#
plot(di,xlab="Índice", ylab="Distância de Cook", pch=16)
#identify(di, n=2)
#
plot(fitted(fit.model),td,xlab="Valor Ajustado", ylab="Resíduo Componente do Desvio",
ylim=c(b-1,a+1),pch=16)
abline(2,0,lty=2)
abline(-2,0,lty=2)
#identify(fitted(fit.model),td, n=1)
#
w <- fit.model$weights
eta <- predict(fit.model)
z <- eta + resid(fit.model, type="pearson")/sqrt(w)
plot(predict(fit.model),z,xlab="Preditor Linear", 
ylab="Variável z", pch=16)
par(mfrow=c(1,1))
#------------------------------------------------------------#

```

```{r}
 detach("package:MASS", unload = TRUE)
```

### Removendo linhas
```{r}
teste<-td
teste1 <- sort(teste)
match(teste1[1:3], teste)
```
```{r}
Temporario<- Temporario_glm_log_log_mu_NE_17[c(-177 ,-175 ,-392),]
modelo_glm_log_log_mu_NE_18<- glm((log(log(FLO_M)))~.,Temporario , family = Gamma(link = "1/mu^2" ))
summary(modelo_glm_log_log_mu_NE_18)
```

```{r}
#------------------------------------------------------------#
# Para rodar este programa deixe no objeto fit.model a saída      
# do ajuste da regressão com erros gama e ligação log.  Deixe     
# também os dados disponíveis através do comando attach(...).    
# Depois use o comando source(...) no R ou S-Plus para        
# executar o programa. A sequência de comandos é a seguinte:               
#
       fit.model <- modelo_glm_log_log_mu_NE_18
       attach(Temporario)
       source("envel_gama.txt")                                      
#
# A saída será o gráfico de envelope para o resíduo componente 
# do desvio padronizado. Para colocar um título no gráfico use
# o comando title("..."). Para  usar  outras  ligações mudar 
# no programa abaixo o termo family=Gamma(link=log) para 
# family=Gamma no caso de ligação  recíproca ou por 
# family= Gamma(link=identity) no caso de ligação identidade.
#------------------------------------------------------------#
par(mfrow=c(1,1))
X <- model.matrix(fit.model)
n <- nrow(X)
p <- ncol(X)
w <- fit.model$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit.model,type="response")
fi <- (n-p)/sum((ro/(fitted(fit.model)))^ 2)
td <- resid(fit.model,type="deviance")*sqrt(fi/(1-h))
#
e <- matrix(0,n,100)
#
for(i in 1:100){
resp <- rgamma(n,fi)
resp <- (fitted(fit.model)/fi)*resp
fit <- glm(resp ~ X, family=Gamma(link=log))
w <- fit$weights
W <- diag(w)
H <- solve(t(X)%*%W%*%X)
H <- sqrt(W)%*%X%*%H%*%t(X)%*%sqrt(W)
h <- diag(H)
ro <- resid(fit,type="response")
phi <- (n-p)/sum((ro/(fitted(fit)))^ 2)
e[,i] <- sort(resid(fit,type="deviance")*sqrt(phi/(1-h)))}
#
e1 <- numeric(n)
e2 <- numeric(n)
#
for(i in 1:n){
  eo <- sort(e[i,])
e1[i] <- (eo[2]+eo[3])/2
e2[i] <- (eo[97]+eo[98])/2}
#
med <- apply(e,1,mean)
faixa <- range(td,e1,e2)
par(pty="s")
qqnorm(td, xlab="Percentil da N(0,1)",
ylab="Componente do Desvio", ylim=faixa, pch=16, main="")
par(new=TRUE)
#
qqnorm(e1,axes=F,xlab="",ylab="",type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(e2,axes=F,xlab="",ylab="", type="l",ylim=faixa,lty=1, main="")
par(new=TRUE)
qqnorm(med,axes=F,xlab="", ylab="", type="l",ylim=faixa,lty=2, main="")

#------------------------------------------------------------#          
```

# 4) Modelo final LINK 1/mu^2 



## Importancia dos preditores

```{r}
if(!require(stats)) install.packages("stats")

Anova<- anova(Modelo_GLM_Nordeste)
Anova
```
```{r}

C_E<-data.frame("Variaveis" = row.names(Anova), "importancia" = (Anova$`Sum Sq`/sum(Anova$`Sum Sq`)))
C_E<- C_E %>% arrange(desc(importancia))
options(scipen = 999)
C_E
```
```{r}
ggplot(aes(x=reorder(Variaveis,-importancia ), y = importancia ),data = C_E)+
  geom_col(stat = "identity")+
  labs(y = "Capacidade explicativa", x="" )+
   scale_y_continuous(labels = percent_format()) +
        theme_classic()+
  theme(axis.text.x = element_text(angle=45, hjust=1, vjust = 1))
```

## Contribuição individual dos preditores
### Tabela coef. var

```{r}
# Calculando coeficiente de variação e médias considerando os valores relacionados aos GENOTIPOs contidos no AA

# Coeficiente de variação
coef_var = function(x) {
  coefi<-sd(x)/mean(x)*100
  return(coefi)
}
# Estimativas
 
Estimativas<-summary(Modelo_GLM_Nordeste)
Estimativas<-data.frame(Estimativas$coefficients)
Estimativas<-data.frame("variaveis" = rownames(Estimativas) ,"Estimativa" = Estimativas$Estimate)

# variáveis


 variaveis = c("latitude", "Altitude",  "Tmax_R","Tmax_Media","Tmax_V",   "Tmax_ACC_V", "Tmin_Minima","Tmin_V", "Tmin_ACC_V", "Tmin_ACC_R","Chuva_ACC_V","Chuva_ACC_R", "Rad_ACC", "Rad_ACC_V","UR_Media","UR_R", "Graus_dia_ciclo","Graus_dia_FLO", "FLO_M" ) 



coef_med<-list()



genotipos = c("AA", "IRGA 424")

# filtro
for (z in 1:length(genotipos)) {
  

 Temporario1 = subset(df_Modelo_GLM_Nordeste, GENOTIPO %in% genotipos[z] )



 for(variavel in variaveis){
        # Selecionando colunas
        indexVar = which(names(Temporario1) %in% c('GENOTIPO','FLO_M',variavel))
        
        # Calculando coeficiente de variação
        coef_variacao = lapply(Temporario1[,-indexVar],coef_var)
        coef_variacao = do.call('rbind',coef_variacao)
        coef_variacao = as.data.frame(coef_variacao)
        
        # calculando a media
        
        media = lapply(Temporario1[,-indexVar],mean)
        media = do.call('rbind',media)
        media = as.data.frame(media)
        
        # lista 
 }
 coef_med[[z]]<- c("variaveis" = c(row.names(coef_variacao)),"CV" = c(coef_variacao$V1), "Medias" = c(media$V1))


 }
 
teste<-do.call(cbind.data.frame, coef_med)

coef_med_AA<- data.frame("variaveis"= c(teste[c(1:18),1]), "CV" = as.numeric(c(teste[c(19:36),1])), "Medias"= as.numeric(c(teste[c(37:54),1]) ))
  coef_med_AA[19,1]<- c("(Intercept)")
  coef_med_AA[19,3]<- c(1)
  coef_med_AA<-coef_med_AA %>% inner_join(Estimativas)
  coef_med_AA$`Est_X_Med`<- c(coef_med_AA$Estimativa*coef_med_AA$Medias)
coef_med_AA

coef_med_IRGA424<- data.frame("variaveis"= c(teste[c(1:18),2]), "CV" = as.numeric(c(teste[c(19:36),2])), "Medias"= as.numeric(c(teste[c(37:54),2]) ))
  coef_med_IRGA424[19,1]<- c("(Intercept)")
  coef_med_IRGA424[19,3]<- c(1)
  coef_med_IRGA424<-coef_med_IRGA424 %>% inner_join(Estimativas)
  coef_med_IRGA424[19,4]<- c(coef_med_IRGA424[19,4]+Estimativas[17,2])# linha 21 é irga 424
  coef_med_IRGA424$`Est_X_Med`<- c(coef_med_IRGA424$Estimativa*coef_med_IRGA424$Medias)
coef_med_IRGA424

```

### Corte sem pontos reais

```{r , message=F , warning= F, include=F}
 # Intervalo observado das variáveis
 # formula é y = B1X1+B2X2 ... + BnXn em que todas as variáveis (Xn) estão fixadas na média,  com exeção da variável que se deseja ver a relação. Bn é o Estimate no modelo_Centro_oeste
 
 # Nomes variaveis
 interVariaveis = c("latitude", "Altitude",  "Tmax_R","Tmax_Media","Tmax_V",   "Tmax_ACC_V", "Tmin_Minima","Tmin_V", "Tmin_ACC_V", "Tmin_ACC_R","Chuva_ACC_V","Chuva_ACC_R", "Rad_ACC", "Rad_ACC_V","UR_Media","UR_R", "Graus_dia_ciclo","Graus_dia_FLO")

 plots = list()
 plot  = list()
 coef_meds = list()
 
 coef_meds[1]<- list(coef_med_AA)
  coef_meds[2]<- list(coef_med_IRGA424)
 
 FLOR_previsto_temp<- list() 

 for (j in 1:2) {
 coef<- as.data.frame(coef_meds[[j]])
 #Temporario1 = subset(df_Modelo_GLM_Nordeste, GENOTIPO %in% genotipos[j] )
 
 for(i in 1:length(interVariaveis)){
   
   # Obtendo index
   indexCOEF = which(coef$variaveis %in% interVariaveis[i])
 
   if(length(indexCOEF) > 0){
     
     # Calculo
     Est_X_med = sum(coef[-indexCOEF, 5])
     OBS = unique(df_Modelo_GLM_Nordeste[, interVariaveis[i]])
     
      
     
     # Criando data.frame temporario
     previsto_temp = data.frame(OBS,
                                prev = Est_X_med + (OBS * (coef[indexCOEF, 4])))
     # Renomeando colunas
     nomesColunas = c(
       paste(interVariaveis[i]),
       paste(interVariaveis[i], "FLO", "prev", sep = "_")
     )
     colnames(previsto_temp) = nomesColunas
     
     FLOR_previsto_temp[[i]]<-previsto_temp
            
     #previsto_temp = previsto_temp %>%  filter(between(previsto_temp[,2], 50 , 110))


     # Graficos
     g = ggplot(previsto_temp, aes_string(x = nomesColunas[1], y = nomesColunas[2] )) +
       geom_point()+ 
       geom_smooth(formula = y ~ x)+
        labs(x = nomesColunas[1], y = "")
      

     
     plot[[i]] = g
     
   }
   FLOR_previsto[[j]]<-FLOR_previsto_temp

       plots[[j]] =  plot
 }  
 }
    

# Plotando graficos

 figura1<- ggarrange(plots = plots[[1]])  # AA 
  
 figura2<- ggarrange(plots = plots[[2]])# IRGA 424
```
```{r}
  ggpubr::annotate_figure(figura1, top = "Respostas relativas aos genótipos agrupados na média", left = "Florescimento médio previsto")

  ggpubr::annotate_figure(figura2, top = "Respostas relativas ao genótipo IRGA 424", left = "Florescimento médio previsto")

```

### Corte com pontos reais 

```{r , message=F , warning= F, include=F}
 # Intervalo observado das variáveis
 # formula é y = B1X1+B2X2 ... + BnXn em que todas as variáveis (Xn) estão fixadas na média,  com exeção da variável que se deseja ver a relação. Bn é o Estimate no modelo_Centro_oeste
 
 # Nomes variaveis
 interVariaveis = c("latitude", "Altitude",  "Tmax_R","Tmax_Media","Tmax_V",   "Tmax_ACC_V", "Tmin_Minima","Tmin_V", "Tmin_ACC_V", "Tmin_ACC_R","Chuva_ACC_V","Chuva_ACC_R", "Rad_ACC", "Rad_ACC_V","UR_Media","UR_R", "Graus_dia_ciclo","Graus_dia_FLO")

 plots = list()
 plot  = list()
 coef_meds = list()
 
 coef_meds[1]<- list(coef_med_AA)
 coef_meds[2]<- list(coef_med_IRGA424)
  FLO_OBS = data.frame()
 FLOR_previsto<- list()
 FLOR_previsto_temp<- list()

 for (j in 1:2) {
 coef<- as.data.frame(coef_meds[[j]])
 filtro = subset(df_Modelo_GLM_Nordeste, GENOTIPO %in% genotipos[j] )
 
 for(i in 1:length(interVariaveis)){
   
   # Obtendo index
   indexCOEF = which(coef$variaveis %in% interVariaveis[i])
 
   if(length(indexCOEF) > 0){
     
     # Calculo
     Est_X_med = sum(coef[-indexCOEF, 5])
     OBS = unique(df_Modelo_GLM_Nordeste[, interVariaveis[i]])
     FLO_OBS = filtro %>% group_by_at(interVariaveis[i]) %>% summarise(FLO_M = mean(FLO_M))
      colnames(FLO_OBS) <- c("X", "FLO_M")
      
     
     # Criando data.frame temporario
     previsto_temp = data.frame(OBS,
                                prev = Est_X_med + (OBS * (coef[indexCOEF, 4])))
     # Renomeando colunas
     nomesColunas = c(
       paste(interVariaveis[i]),
       paste(interVariaveis[i], "FLO", "prev", sep = "_")
     )
     colnames(previsto_temp) = nomesColunas
     
     FLOR_previsto_temp[[i]]<-previsto_temp
     

     
     # Graficos
       g = ggplot() +
       geom_point(data = FLO_OBS, aes_string(x = "X" , y = "FLO_M"  ), color = "black") +
       geom_smooth(data = FLO_OBS, aes_string(x = "X" , y = "FLO_M"), formula = y ~ x, color = "blue"  )+
        geom_point(data = previsto_temp, aes_string(x = nomesColunas[1], y = nomesColunas[2] ), color = "red") +
       geom_smooth(data = previsto_temp, aes_string(x = nomesColunas[1], y = nomesColunas[2] ),formula = y ~ x, color = "red")+
        labs(x = nomesColunas[1], y = "")
      

     
     plot[[i]] = g
     
   }
   FLOR_previsto[[j]]<-FLOR_previsto_temp

       plots[[j]] =  plot
 }  
 }
    

# Plotando graficos

 figura1<- ggarrange(plots = plots[[1]])  # AA 
  
 figura2<- ggarrange(plots = plots[[2]]) # IRGA 430
```
```{r}
  ggpubr::annotate_figure(figura1, top = "Respostas relativas aos genótipos agrupados na média", left = "Florescimento médio")

  ggpubr::annotate_figure(figura2, top = "Respostas relativas ao genótipo IRGA 430", left = "Florescimento médio")

```
### Somente quartis 

```{r}

interVariaveis = c("latitude", "Altitude",  "Tmax_R","Tmax_Media","Tmax_V",   "Tmax_ACC_V", "Tmin_Minima","Tmin_V", "Tmin_ACC_V", "Tmin_ACC_R","Chuva_ACC_V","Chuva_ACC_R", "Rad_ACC", "Rad_ACC_V","UR_Media","UR_R", "Graus_dia_ciclo","Graus_dia_FLO")

genotipos = c("AA","IRGA 424")

quart<- list()
quartis=data.frame()
Quartil <- list()
Teste = list()
# Estimativas
 
 Estimativas<-summary(Modelo_GLM_Nordeste)
Estimativas<-data.frame(Estimativas$coefficients)
Estimativas<-data.frame("variaveis" = rownames(Estimativas) ,"Estimativa" = Estimativas$Estimate)
 
for (j in 1:2) {
 
        Temporario1 = subset(df_Modelo_GLM_Nordeste, GENOTIPO %in% genotipos[j] )

 
for(i in 1:length(interVariaveis)){
         
variavel = data.frame(Temporario1[,interVariaveis[i]])
quart[[interVariaveis[i]]] = quantile(variavel[,1] , c(0.25 , 0.50 , 0.75))
 }

teste<-do.call(cbind.data.frame, quart)
teste<-as.data.frame(t(teste))
quartis = data.frame(row.names(teste), teste$`25%`,teste$`50%`, teste$`75%` )
colnames(quartis)<- c("variaveis", "25%","50%", "75%")


quartis[17,1]<- c("(Intercept)")
  quartis[17,3]<- c(1)
  quartis<-quartis %>% inner_join(Estimativas)
  quartis$`Est_X_Mediana`<- c(quartis$Estimativa*quartis$`50%`)
Teste[[j]]<-do.call(cbind.data.frame, quart)  
       
  Quartil[[genotipos[j]]]<-quartis 
}

Quartil[["AA"]]
Quartil[["IRGA 424"]]
```

```{r, message=F , warning= F, include=F}

 # Intervalo observado das variáveis
 # formula é y = B1X1+B2X2 ... + BnXn em que todas as variáveis (Xn) estão fixadas na média,  com exeção da variável que se deseja ver a relação. Bn é o Estimate no modelo_Centro_oeste_corrigido

 interVariaveis = c("longitude", "Altitude", "Tmax_Maxima", "Tmax_R", "Tmax_ACC_R", "Tmin_V", "Tmin_ACC_V", "Tmin_fld_m", "Tmin_R",  "Tmin_ACC_R",  "Rad_ACC", "Rad_ACC_V", "UR_Media", "UR_R", "Graus_dia_ciclo", "Graus_dia_FLO")

genotipos = c("AA", "IRGA 424")


  plot  = list()
  plots = list()
 
previsto<-list()

for (j in 1:2) {
      Temporario <- Quartil[[genotipos[j]]]
              Temporario2 = as.data.frame(Teste[[j]])

 for(i in 1:length(interVariaveis)){
   
   # Obtendo index
   indexCOEF = which(Temporario$variaveis %in% interVariaveis[i])
 
   if(length(indexCOEF) > 0){
     
     # Calculo
     Est_X_medana = sum(Temporario[-indexCOEF, 6])
     quartil = Temporario2[,interVariaveis[i]]
     
      
     
     # Criando data.frame temporario
     previsto_temp = data.frame(quartil,
                                prev = Est_X_medana + (quartil * (Temporario[indexCOEF, 5])))
     # Renomeando colunas
     nomesColunas = c(
       paste(interVariaveis[i]),
       paste("Florescimento_previsto", i, sep = ".")
     )
         colnames(previsto_temp) = nomesColunas

     # Graficos
     g = ggplot(previsto_temp, aes_string(x = nomesColunas[1], y = nomesColunas[2] )) +
       geom_point()+ 
       geom_line()+
        labs(x = nomesColunas[1], y = "")
      
     

     
        
   }
   plot[[i]] = g
  
  previsto[[genotipos[j]]][[i]]<-previsto_temp   
    
  
 }
  plots[[j]] = plot  
}

figura1<- ggarrange(plots = plots[[1]])  # AA 
figura2<- ggarrange(plots = plots[[2]])  # IRGA 424  

```
```{r}
tabela = list()
Tabela = list()
for (i in 1:4) {
 
tabela[[i]]<- do.call(cbind.data.frame, previsto[[i]])

Tabela[[i]]<- data.frame(t(tabela[[1]]))

colnames(Tabela[[i]])<- c("25%", "50%", "75%")
}

Tabela[[1]] # AA

Tabela[[2]] # IRGA 424
```
```{r}
  ggpubr::annotate_figure(figura1, top = "Respostas relativas aos genótipos agrupados na média", left = "Florescimento médio previsto")

  ggpubr::annotate_figure(figura2, top = "Respostas relativas ao genótipo IRGA 424", left = "Florescimento médio previsto")
```



## Erro de previsão

```{r}

Temporario1<- df_Modelo_GLM_Nordeste

Temporario1$`Yhat` <-exp(predict ( Modelo_GLM_Nordeste, df_Modelo_GLM_Nordeste ))
Temporario1$`residual` = c(exp(resid ( Modelo_GLM_Nordeste )))
Temporario1$`Y_yhat` = c(Temporario1$FLO_M - Temporario1$Yhat)


  
  
  boxplot(Temporario1$Y_yhat, main = "Todos os genótipos", xlab = "Y - Yhat" )
  plot(y = Temporario1$FLO_M, x = Temporario1$Yhat,  main = "Todos os genótipos", xlab = "Yhat", ylab = "Y", pch = 20, 
     col = "black") 

 
  
  teste = subset(Temporario1, GENOTIPO %in% "IRGA 424" )
  boxplot(teste$Y_yhat, main = "Genótipo IRGA 424", xlab = "Y - Yhat" )
  plot(y = teste$FLO_M, x = teste$Yhat,  main = "Genótipo IRGA 424", xlab = "Yhat", ylab = "Y", pch = 20, 
     col = "black") 
  
  
  
 

```

